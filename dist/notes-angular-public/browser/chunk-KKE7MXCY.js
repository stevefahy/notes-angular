import{a as se,b as Ce}from"./chunk-HPEA7SNV.js";import{a as ge}from"./chunk-FYMGHUKC.js";import{b as _e,c as be}from"./chunk-64SVY3WO.js";import{a as he,c as me,e as pe,h as fe}from"./chunk-322FMVNF.js";import{B as ne,C as re,D as ae,E as de,H as le,_ as ce,aa as ue,d as Z,h as ee,j as te,l as ie,n as R,p as C,q as b,r as V,s as y,v as oe}from"./chunk-4KA7YYCZ.js";import{$b as g,Ba as s,Ga as B,Lb as m,Mb as p,Pb as M,Qb as d,Rb as a,Sb as D,Xb as T,Y as w,Zb as x,Zc as P,a as H,b as W,cd as Y,db as l,dc as G,ea as $,ec as Q,fc as J,ia as U,j as h,ja as q,mb as E,n as F,nc as _,oa as z,pa as N,qa as S,qc as K,rc as X,sb as O,tb as A}from"./chunk-AS4DOYW2.js";var Le=()=>{let t=()=>{o.update(i=>W(H({},i),{width:window.innerWidth,height:window.innerHeight,viewnote_width:document.querySelector("#viewnote_id")&&document.querySelector("#viewnote_id").clientWidth<window.innerWidth?document.querySelector("#viewnote_id").clientWidth:document.querySelector("#viewnote_id")?window.innerWidth-b.VIEWNOTE_PADDING_MOBILE:window.innerWidth-b.VIEWNOTE_PADDING}))},o=s({width:0,height:0,viewnote_width:0,addListener:()=>{window.addEventListener("resize",t)},removeListener:()=>{window.removeEventListener("resize",t)}});return t(),o},ve=Le;var De=b,we=(t,r,e)=>h(null,null,function*(){let o;try{if(o=yield fetch(V.APP_API_ENDPOINT+`api/data/notebook/${r}/${e}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),o.status===404)throw new Error(`${o.url} Not Found.`)}catch(c){return{error:C(c)}}let i;try{if(i=yield o.json(),i===null)return{error:`${De.NOTE_ERROR}`}}catch(c){return{error:C(c)}}return i.error?{error:i.error}:i});var $e=b,Ne=(t,r,e,o)=>h(null,null,function*(){let i,c={notebookID:r,noteID:e,note:o};try{if(i=yield fetch(V.APP_API_ENDPOINT+"api/data/save-note",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(c)}),i.status===404)throw new Error(`${i.url} Not Found.`)}catch(v){return{error:C(v)}}let f;try{if(f=yield i.json(),f===null)return{error:`${$e.NOTE_SAVE_ERROR}`}}catch(v){return{error:C(v)}}return f.error?{error:f.error}:f});var Oe=b,Se=(t,r)=>h(null,null,function*(){let e;try{if(e=yield fetch(V.APP_API_ENDPOINT+"api/data/create-note",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(r)}),e.status===404)throw new Error(`${e.url} Not Found.`)}catch(i){return{error:C(i)}}let o;try{if(o=yield e.json(),o===null)return{error:`${Oe.NOTE_CREATE_ERROR}`}}catch(i){return{error:C(i)}}return o.error?{error:o.error}:o});var L=!1,k,I,Te=()=>{k=document.querySelector("#edit"),I=document.querySelector("#view"),Ae()};var xe=(t,r)=>{let e=r.scrollHeight-r.clientHeight,o=t.scrollTop/(t.scrollHeight-t.clientHeight)*100;return e*(o/100)},Ee=()=>{k?.removeEventListener("scroll",ye),I?.removeEventListener("scroll",ke)},ye=()=>{let t=I,e=xe(k,t);var o=L;L=!1,!o&&(L=!0,t.scrollTop=e)},ke=()=>{let t=I,r=k,e=xe(t,r);var o=L;L=!1,!o&&(L=!0,r.scrollTop=e)},Ae=()=>{I!==null&&k!==null&&k.addEventListener("scroll",ye),I!==null&&k!==null&&I.addEventListener("scroll",ke)};var Re=["noteInputRef"],Ie=(()=>{class t{constructor(){this.isVisible=s(!1),this.isSplitscreen=s(!1),this.setText=e=>{this.updateViewText(e.currentTarget.innerText)}}set passUpdatedViewText(e){this.noteInputRef&&this.noteInputRef.nativeElement&&this.noteInputRef.nativeElement.innerText!==e&&(this.noteInputRef.nativeElement.innerText=e)}ngOnChanges(e){e.visible&&this.isVisible.set(e.visible.currentValue),e.splitScreen&&this.isSplitscreen.set(e.splitScreen.currentValue)}ngOnInit(){}ngAfterViewInit(){this.loadedText===""&&this.noteInputRef.nativeElement&&this.noteInputRef.nativeElement.focus(),this.loadedText&&this.noteInputRef.nativeElement&&(this.noteInputRef.nativeElement.innerText=this.loadedText)}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=O({type:t,selectors:[["EditNote"]],viewQuery:function(o,i){if(o&1&&G(Re,5),o&2){let c;Q(c=J())&&(i.noteInputRef=c.first)}},inputs:{visible:"visible",splitScreen:"splitScreen",loadedText:"loadedText",updateViewText:"updateViewText",passUpdatedViewText:"passUpdatedViewText"},standalone:!1,features:[B],decls:6,vars:4,consts:[["noteInputRef",""],["id","edit",3,"ngClass"],["ngClass","viewnote_content editor"],["ngClass","viewnote_content editable","data-placeholder","Start writing...'",3,"input","contentEditable"]],template:function(o,i){if(o&1){let c=T();d(0,"div",1)(1,"mat-card")(2,"mat-card-content")(3,"article",2)(4,"div",3,0),x("input",function(v){return N(c),S(i.setText(v))}),a()()()()()}o&2&&(M("ngClass",X("edit editnote_box ",i.isVisible()?"show editting":i.isSplitscreen()?"show":"hide")),l(4),M("contentEditable",K(i.isVisible()||i.isSplitscreen())))},dependencies:[P,ae,de],encapsulation:2})}}return t})();function He(t,r){t&1&&D(0,"LoadingScreen")}function We(t,r){if(t&1&&(d(0,"div",1),D(1,"ViewNote",7)(2,"EditNote",8),a()),t&2){let e=g();l(),M("visible",!e.isView())("splitScreen",e.isSplitScreen())("viewText",e.viewText())("updatedViewText",e.updatedViewTextHandler),l(),M("visible",e.isView())("splitScreen",e.isSplitScreen())("loadedText",e.loadedText())("updateViewText",e.updatedViewTextHandler)("passUpdatedViewText",e.updateEditTextProp())}}function Fe(t,r){if(t&1){let e=T();d(0,"button",9),x("click",function(){N(e);let i=g();return S(i.saveNoteCallback())}),d(1,"span",10)(2,"span",11),_(3," add_circle "),a(),_(4," Save Note "),a()()}}function Ue(t,r){if(t&1){let e=T();d(0,"button",12),x("click",function(){N(e);let i=g();return S(i.createNotePost())}),d(1,"span",10)(2,"span",11),_(3," add_circle "),a(),_(4," Create Note "),a()()}}function qe(t,r){if(t&1){let e=T();d(0,"button",13),x("click",function(){N(e);let i=g();return S(i.exampleNote())}),d(1,"span",10)(2,"span",11),_(3," egg "),a(),_(4," Example "),a()()}}function ze(t,r){t&1&&(d(0,"span",10)(1,"span",11),_(2," visibility "),a(),_(3," View "),a())}function Be(t,r){t&1&&(d(0,"span",10)(1,"span",11),_(2," edit "),a(),_(3," Edit "),a())}function Ge(t,r){if(t&1){let e=T();d(0,"button",14),x("click",function(){N(e);let i=g();return S(i.toggleEditHandlerCallback())}),m(1,ze,4,0,"span",10),m(2,Be,4,0,"span",10),a()}if(t&2){let e=g();l(),p(e.isView()?1:-1),l(),p(e.isView()?-1:2)}}function Qe(t,r){t&1&&(d(0,"span",16),D(1,"img",17),a())}function Je(t,r){t&1&&(d(0,"span",16),D(1,"img",18),a())}function Ke(t,r){if(t&1){let e=T();d(0,"button",15),x("click",function(){N(e);let i=g();return S(i.toggleSplitHandlerCallback())}),m(1,Qe,2,0,"span",16),m(2,Je,2,0,"span",16),a()}if(t&2){let e=g();l(),p(e.isSplitScreen()?1:-1),l(),p(e.isSplitScreen()?-1:2)}}var Xe=b,Me=(()=>{class t{constructor(e,o,i,c,f,v){this.activatedRoute=e,this.authService=o,this.store=i,this.http=c,this.router=f,this.authGuard=v,this.new_note=!1,this.WELCOME_NOTE=s(""),this.viewText=s(""),this.loadedText=s(""),this.isMobile=s(!1),this.originalText=s(""),this.updateEditTextProp=s(""),this.noteLoaded=s(!1),this.notebookLoaded=s(!1),this.autoSave=s(!1),this.autoSave$=y(this.autoSave),this.isChanged=s(!1),this.isChanged$=y(this.isChanged),this.isCreate=s(this.new_note),this.isCreate$=y(this.isCreate),this.isView=s(this.new_note),this.isView$=y(this.isView),this.isSplitScreen=s(!1),this.isSplitScreen$=y(this.isSplitScreen),this.unsavedChanges=s(!0),this.injector=U(q),this.onDestroy$=new F,this.showSnack=()=>{this.store.dispatch(Ce.showSnack({snack:{n_status:!0,message:"Note Saved"}}))},this.exampleNote=()=>{this.isMobile()||this.isSplitScreen.set(!0),this.updatedViewTextHandler(this.WELCOME_NOTE())},this.updatedViewTextHandler=n=>{this.updateIsChanged(n),this.viewText.update(u=>n),this.updateEditTextProp.set(n)},this.updateIsChanged=n=>{n!==this.originalText()?this.isChanged.update(u=>!0):this.isChanged.update(u=>!1)},this.createNotePost=()=>h(this,null,function*(){if(this.token&&this.notebookId&&this.viewText()){this.autoSave.set(!1);let n={notebookId:this.notebookId,note:this.viewText()};try{let u=yield Se(this.token,n);if(this.notebookLoaded.set(!0),u.error){this.showNotification(`${u.error}`);return}u.success&&(this.isCreate.set(!1),this.isChanged.set(!1),this.autoSave.set(!1),this.router.navigate([`/notebook/${this.notebookId}`]))}catch(u){this.showNotification(`${u}`);return}}}),this.saveNoteCheck=()=>h(this,null,function*(){this.autoSave()&&this.isChanged()&&(this.isView()||this.isChanged())&&!this.isCreate()&&h(this,null,function*(){yield this.saveNoteCallback(),this.autoSave.update(u=>!1),this.isChanged.set(!1),this.authGuard.deactivate=!0,this.router.navigate([`${this.navigationUrl}`])})}),this.toggleEditHandlerCallback=()=>{this.isView.set(!this.isView())},this.toggleSplitHandlerCallback=()=>{this.isSplitScreen.set(!this.isSplitScreen())},this.saveNoteCallback=()=>h(this,null,function*(){if(this.token&&this.notebookId&&this.noteId&&this.viewText()){let n;try{if(n=yield Ne(this.token,this.notebookId,this.noteId,this.viewText()),n.error){this.showNotification(`${n.error}`);return}if(n.success)return this.isChanged.update(u=>!1),this.autoSave.update(u=>!1),this.originalText.set(this.viewText()),this.isView()&&this.toggleEditHandlerCallback(),n}catch(u){this.showNotification(`${u}`);return}}else return}),this.dimensionsChange=()=>{this.addListener(),this.width<Xe.SPLITSCREEN_MINIMUM_WIDTH?(this.isSplitScreen.set(!1),this.isMobile.set(!0)):this.isMobile.set(!1)},this.loadMarkdown=()=>h(this,null,function*(){this.http.get("../../assets/markdown/welcome_markdown_angular.md",{responseType:"text"}).subscribe(n=>{this.WELCOME_NOTE.set(n)})}),this.loadNote=()=>h(this,null,function*(){if(!this.isCreate()&&this.notebookId&&this.noteId&&this.noteId!=="create-note"&&!this.noteLoaded()&&this.token){this.noteLoaded.set(!1);try{let n=yield we(this.token,this.notebookId,this.noteId);if(n.error){this.showNotification(`${n.error}`);return}n.success&&(this.viewText.set(n.note.note),this.loadedText.set(n.note.note),this.originalText.set(n.note.note),this.noteLoaded.set(!0))}catch(n){this.showNotification(`${n}`);return}}else this.noteLoaded.set(!0)}),this.loadNotebook=()=>h(this,null,function*(){if(!this.notebookLoaded()&&this.token&&this.notebookId){this.notebookLoaded.set(!1);try{let n=yield ge(this.token,this.notebookId);if(this.notebookLoaded.set(!0),n.error){this.showNotification(`${n.error}`);return}n.success&&this.store.dispatch(me.edited(n.notebook))}catch(n){this.showNotification(`${n}`),this.notebookLoaded.set(!0);return}}}),this.updateContext=n=>{this.loading=n.loading,this.token=n.token},this.showNotification=n=>{this.store.dispatch(ne.showNotification({notification:{n_status:"error",title:"Error!",message:n}}))},f.events.subscribe(n=>{n instanceof ee&&(this.navigationUrl=n.url,this.isChanged()&&!this.isCreate()&&(v.deactivate=!1,this.autoSave.update(u=>!0)))})}ngOnDestroy(){this.removeListener(),Ee(),this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){z(this.injector,()=>{this.windowDimensions$=y(ve()),this.windowDimensions$.pipe(w(this.onDestroy$)).subscribe(e=>{this.width=e.width,this.height=e.height,this.addListener=e.addListener,this.removeListener=e.removeListener,this.dimensionsChange()}),this.autoSave$.pipe(w(this.onDestroy$)).subscribe(e=>{e&&(this.saveNoteCheck(),this.showSnack())})}),this.activatedRoute.params.pipe(w(this.onDestroy$)).subscribe(e=>{this.noteId=e.noteId,this.notebookId=e.notebookId}),this.authService.authContext$.pipe(w(this.onDestroy$)).subscribe(e=>{this.updateContext(e)}),this.loadNote(),this.loadNotebook(),this.loadMarkdown(),setTimeout(()=>{Te()},500),this.noteId==="create-note"&&(this.new_note=!0,this.isCreate.set(!0),this.isView.set(!0)),this.isChanged$.pipe(w(this.onDestroy$)).subscribe(e=>{e&&this.saveNoteCheck()}),this.isView$.pipe(w(this.onDestroy$)).subscribe(e=>{e&&this.saveNoteCheck()}),this.isCreate$.pipe(w(this.onDestroy$)).subscribe(e=>{e&&this.saveNoteCheck()})}static{this.\u0275fac=function(o){return new(o||t)(E(te),E(re),E(oe),E(Z),E(ie),E(se))}}static{this.\u0275cmp=O({type:t,selectors:[["Note"]],standalone:!1,decls:9,vars:7,consts:[["ngClass","page_scrollable_header_breadcrumb_footer"],["ngClass","view_container","id","view_container"],["mat-button","","color","secondary","aria-label","Save Note button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Create Note button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Example Note button","ngClass","contained medium breadcrumb_edit_fab button_fab example_button"],["mat-button","","color","secondary","aria-label","Toggle View button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Toggle Split Screen button","ngClass","contained medium breadcrumb_edit_fab button_fab split_screen_button"],[3,"visible","splitScreen","viewText","updatedViewText"],[3,"visible","splitScreen","loadedText","updateViewText","passUpdatedViewText"],["mat-button","","color","secondary","aria-label","Save Note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["ngClass","icon_text"],["ngClass","material-symbols-outlined button_icon white"],["mat-button","","color","secondary","aria-label","Create Note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Example Note button","ngClass","contained medium breadcrumb_edit_fab button_fab example_button",3,"click"],["mat-button","","color","secondary","aria-label","Toggle View button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Toggle Split Screen button","ngClass","contained medium breadcrumb_edit_fab button_fab split_screen_button",3,"click"],["className","split_screen_icon"],["src","/assets/images/split_screen_icon_single.png","alt","split screen icon","width","30","height","30"],["src","/assets/images/split_screen_icon_double.png","alt","split screen icon","width","30","height","30"]],template:function(o,i){o&1&&(m(0,He,1,0,"LoadingScreen"),d(1,"div",0),m(2,We,3,9,"div",1),a(),d(3,"Footer"),m(4,Fe,5,0,"button",2),m(5,Ue,5,0,"button",3),m(6,qe,5,0,"button",4),m(7,Ge,3,2,"button",5),m(8,Ke,3,2,"button",6),a()),o&2&&(p(!i.noteLoaded()||i.token===null?0:-1),l(2),p(i.noteLoaded()&&i.token!==null?2:-1),l(2),p(i.noteLoaded()&&i.viewText().length>0&&!i.isCreate()&&i.isChanged()?4:-1),l(),p(i.noteLoaded()&&i.viewText().length>0&&i.isCreate()?5:-1),l(),p(i.noteLoaded()&&i.viewText().length===0&&i.isCreate()?6:-1),l(),p(i.noteLoaded()&&!i.isSplitScreen()?7:-1),l(),p(i.noteLoaded()&&!i.isMobile()?8:-1))},dependencies:[P,he,pe,le,_e,Ie],encapsulation:2,changeDetection:0})}}return t})();var Ye=[{path:"",component:Me}],Ve=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=A({type:t})}static{this.\u0275inj=$({imports:[R.forChild(Ye),R]})}}return t})();var ci=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=A({type:t})}static{this.\u0275inj=$({imports:[Y,Ve,fe,ce,ue,be]})}}return t})();export{ci as NoteModule};
