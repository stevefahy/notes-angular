import{b as fe}from"./chunk-AKBM2F3O.js";import{a as Se,b as q,c as Me,d as De,e as Ee,f as Te,g as Le,h as Oe,i as Ae}from"./chunk-E4OQM5UZ.js";import"./chunk-AG27GIWE.js";import{a as be,b as _e,c as ge,d as Ne,e as Ce,f as ke}from"./chunk-2EAVR2BT.js";import{a as Ve,b as Ye,c as Fe}from"./chunk-C2VYKEBI.js";import{a as R}from"./chunk-Y6ES3VOY.js";import{a as Pe,b as $e,c as Ie}from"./chunk-BLADA7VU.js";import{b as Q}from"./chunk-ST4WOKTC.js";import{a as we,b as ve,d as ye}from"./chunk-UKSJPWJC.js";import{a as xe}from"./chunk-6BJ5XD2S.js";import{D as me,i as de,k as le,l as ce,oa as U,q as ue,qa as W,r as T,ra as w,sa as _,ta as v,ua as he,wa as pe}from"./chunk-NOSQJU4U.js";import{j as P,o as A}from"./chunk-AHN2ECLX.js";import{$b as ne,Fb as j,Gb as f,Hb as b,Ib as B,Jb as z,Kb as k,Lb as d,Mb as l,Nb as O,Rb as te,Sb as D,Ub as g,V as C,Wb as m,_b as oe,a as I,ab as u,ac as ie,b as V,ea as M,fa as Y,fc as p,g as Xe,h,hc as J,ic as re,jc as se,ka as Z,kc as ae,l as F,la as y,lb as ee,ma as x,pb as L,s as H,xa as c}from"./chunk-B363HPCM.js";var Ze=w,Re=(n,a)=>h(null,null,function*(){let e;try{if(e=yield fetch(v.APP_API_ENDPOINT+`api/data/notes/${a}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}}),e.status===404)throw new Error(`${e.url} Not Found.`)}catch(o){return{error:_(o)}}let t;try{if(t=yield e.json(),t===null)return{error:`${Ze.NOTES_ERROR}`}}catch(o){return{error:_(o)}}return t.error?{error:t.error}:t});var et=w,He=(n,a)=>h(null,null,function*(){let e,t={note_ids:a};try{if(e=yield fetch(v.APP_API_ENDPOINT+"api/data/delete-notes",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)}),e.status===404)throw new Error(`${e.url} Not Found.`)}catch(i){return{error:_(i)}}let o;try{if(o=yield e.json(),o===null)return{error:`${et.NOTES_DELETE_ERROR}`}}catch(i){return{error:_(i)}}return o.error?{error:o.error}:o});var tt=w,je=(n,a,e)=>h(null,null,function*(){let t,o={notebookID:a,notebookUpdated:e};try{if(t=yield fetch(v.APP_API_ENDPOINT+"api/data/edit-notebook-date",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(o)}),t.status===404)throw new Error(`${t.url} Not Found.`)}catch(r){return{error:_(r)}}let i;try{if(i=yield t.json(),i===null)return{error:`${tt.NOTEBOOK_UPDATE_DATE_ERROR}`}}catch(r){return{error:_(r)}}return i.error?{error:i.error}:i});var ot=w,Be=(n,a)=>h(null,null,function*(){let e;try{let o={notebookID:a};if(e=yield fetch(v.APP_API_ENDPOINT+"api/data/delete-notebook",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(o)}),e.status===404)throw new Error(`${e.url} Not Found.`)}catch(o){return{error:_(o)}}let t;try{if(t=yield e.json(),t===null)return{error:`${ot.NOTEBOOK_DELETE_ERROR}`}}catch(o){return{error:_(o)}}return t.error?{error:t.error}:t});var nt=w,ze=(n,a,e,t,o)=>h(null,null,function*(){let i,r={notebookID:a,notebookName:e,notebookCover:t,notebookUpdated:o};try{if(i=yield fetch(v.APP_API_ENDPOINT+"api/data/edit-notebook",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(r)}),i.status===404)throw new Error(`${i.url} Not Found.`)}catch(N){return{error:_(N)}}let s;try{if(s=yield i.json(),s===null)return{error:`${nt.NOTES_ERROR}`}}catch(N){return{error:_(N)}}return s.error?{error:s.error}:s});var it=w,Je=(n,a,e,t)=>h(null,null,function*(){let o,i={notes:e,notebookID:a,latestUpdatedNote:t};try{if(o=yield fetch(v.APP_API_ENDPOINT+"api/data/move-notes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(i)}),o.status===404)throw new Error(`${o.url} Not Found.`)}catch(s){return{error:_(s)}}let r;try{if(r=yield o.json(),r===null)return{error:`${it.NOTES_ERROR}`}}catch(s){return{error:_(s)}}return r.error?{error:r.error}:r});var st=["errorcontainer"];function at(n,a){if(n&1&&(d(0,"option",17),p(1),l()),n&2){let e=m().$implicit;k("value",e._id),u(),J(" ",e.notebook_name," ")}}function dt(n,a){if(n&1&&f(0,at,2,2,"option",17),n&2){let e=a.$implicit,t=m(2);b(e._id!==t.notebookId?0:-1)}}function lt(n,a){if(n&1&&B(0,dt,1,1,null,null,j().trackByNotebooks,!0),n&2){let e=m();z(e.notebooksSorted())}}function ct(n,a){n&1&&te(0,null,0)}var Ue=(()=>{class n{constructor(){this.selectedNotebook=c(""),this.formIsValid=c(!1),this.notebooksSorted=c(null),this.error=c({error_state:!1,error_severity:"",message:""}),this.error$=T(this.error),this.data=M(Me),this.onDestroy$=new F,this.trackByNotebooks=(e,t)=>t?t._id:void 0,this.findNotebook=e=>{let t=this.notebooks.findIndex(o=>o._id===e);return this.notebooks[t]},this.sortNotes=e=>(e.forEach(t=>{t.updatedAt==="No date"&&(t.updatedAt="December 17, 1995 03:24:00"),t.createdAt==="No date"&&(t.createdAt="December 17, 1995 03:24:00")}),e.sort((t,o)=>t.updatedAt!==void 0&&o.updatedAt!==void 0?new Date(t.updatedAt)>new Date(o.updatedAt)?1:-1:t.updatedAt!==void 0?1:-1).reverse(),e),this.cancelHandler=e=>{e.preventDefault(),e.stopPropagation(),this.error().error_state&&this.resetError(),this.onCancel()},this.submitHandler=e=>h(this,null,function*(){if(e.preventDefault(),e.stopPropagation(),this.error().error_state&&this.resetError(),this.findNotebook(this.selectedNotebook()),!this.selectedNotebook()){this.formIsValid.set(!1);return}this.moveNotes(this.selectedNotebook()),this.onCancel()}),this.resetError=()=>{this.componentRef&&this.componentRef.destroy(),this.formIsValid.set(!0),this.error.update(e=>V(I({},e),{error_state:!1,error_severity:"",message:""}))},this.handleChange=e=>{this.selectedNotebook.update(t=>e.target.value),e.target.value==="default"?this.formIsValid.set(!1):this.formIsValid.set(!0)}}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.onCancel=this.data.onCancel,this.moveNotes=this.data.moveNotes,this.notebooks=this.data.notebooks,this.notebookId=this.data.notebookId,this.notebooks$=H(this.notebooks),this.notebooks$.pipe(C(this.onDestroy$)).subscribe(e=>{if(e){let t=this.sortNotes(e);this.notebooksSorted.set(t)}}),this.error$.pipe(C(this.onDestroy$)).subscribe(e=>{e.error_state&&this.addErrorComponent()})}addErrorComponent(){import("./chunk-R2W3RU65.js").then(e=>{let t=e.LazyLoadedModule.components.dynamicComponent;this.componentRef=this.errorcontainer.createComponent(t),this.componentRef.instance.error_state=this.error().error_state,this.componentRef.instance.error_severity=this.error().error_severity,this.componentRef.instance.message=this.error().message})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=L({type:n,selectors:[["SelectNotebookForm"]],viewQuery:function(t,o){if(t&1&&oe(st,5,ee),t&2){let i;ne(i=ie())&&(o.errorcontainer=i.first)}},inputs:{notebooks:"notebooks",onCancel:"onCancel",moveNotes:"moveNotes"},decls:25,vars:3,consts:[["errorcontainer",""],["ngClass","dialogue_container"],["mat-dialog-title","","ngClass","dialogue-title"],["mat-dialog-content",""],["ngClass","form"],["ngClass","control"],["htmlFor","new-notebook-cover"],["name","notebooks","id","notebooks","value","selectedNotebook",3,"change"],["defaultValue","true","value","default"],["ngClass","button_row"],["ngClass","action"],["ngClass","move"],["mat-button","","color","secondary","aria-label","Move Note button","ngClass","contained medium",3,"click","disabled"],["ngClass","icon_text"],["ngClass","cancel"],["mat-button","","color","secondary","aria-label","Edit notebook button","ngClass","contained medium",3,"click"],["ngClass","material-symbols-outlined button_icon white"],[3,"value"]],template:function(t,o){t&1&&(d(0,"div",1)(1,"h2",2),p(2,"Move to Notebook"),l(),d(3,"div",3)(4,"form",4)(5,"div",5)(6,"label",6),p(7,"Name"),l(),d(8,"select",7),g("change",function(r){return o.handleChange(r)}),d(9,"option",8),p(10," Select a notebook... "),l(),f(11,lt,2,0),l()()(),d(12,"div",9)(13,"div",10)(14,"div",11)(15,"button",12),g("click",function(r){return o.submitHandler(r)}),d(16,"span",13),p(17," Move Note "),l()()(),d(18,"div",14)(19,"button",15),g("click",function(r){return o.cancelHandler(r)}),d(20,"span",13)(21,"span",16),p(22," cancel "),l(),p(23," Cancel "),l()()()()(),f(24,ct,2,0,"ng-container"),l()()),t&2&&(u(11),b(o.notebooks&&o.notebooksSorted()?11:-1),u(4),k("disabled",!o.formIsValid()),u(9),b(o.error().error_state?24:-1))},dependencies:[A,P,ke,ge,Ne,Ce,be,_e,Le,Ee,Te,W,U,Q],styles:[".button_row[_ngcontent-%COMP%]{width:100%}.form[_ngcontent-%COMP%]{width:100%;margin:1rem auto}.control[_ngcontent-%COMP%]{display:flex;margin-bottom:.5rem;flex-direction:row;align-items:flex-start;justify-content:space-between;gap:5px}.control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:.5rem;color:#353336;display:block}.control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:block;font:inherit;max-width:100%;width:200px;border-radius:4px;border:1px solid #38015c;padding:.25rem;background-color:#f7f0fa}.action[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.dialogue_container[_ngcontent-%COMP%]{max-width:300px}@media only screen and (max-width:380px){.control[_ngcontent-%COMP%]{gap:5px}.control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-size:.7rem!important;padding-top:unset;padding-bottom:unset}}"]})}}return n})();var Qe=Xe(Ye());function We(n,a=10){if(!n?.trim())return"";let e=n.split(`
`),t=[],o=0,i=[];for(;o<e.length&&t.length<a;){let r=e[o],s=r.trim();if(s.startsWith("```")){for(i.length>0&&(t.push(i.join(`
`)),i=[]),i=[r],o++;o<e.length&&!e[o].trim().startsWith("```");)i.push(e[o]),o++;o<e.length&&(i.push(e[o]),o++),t.push(i.join(`
`)),i=[];continue}if(s.startsWith("|")){i.length>0&&!i[0].trim().startsWith("|")&&(t.push(i.join(`
`)),i=[]);let S=[r];for(o++;o<e.length&&e[o].trim().startsWith("|");)S.push(e[o]),o++;S.length>=2&&t.length<a&&t.push(S.join(`
`));continue}if(s===""){i.length>0&&(t.push(i.join(`
`)),i=[]),o++;continue}let N=/^#{1,6}\s/.test(s),E=/^[-*+]\s/.test(s)||/^\d+\.\s/.test(s),$=s.startsWith(">");(N||E||$)&&i.length>0&&(t.push(i.join(`
`)),i=[]),i.push(r),o++}return i.length>0&&t.push(i.join(`
`)),t.slice(0,a).join(`

`)}function ut(n,a){n&1&&O(0,"ngx-skeleton-loader",0)}function mt(n,a){if(n&1&&O(0,"ViewNoteMarkdown",3),n&2){let e=m(2);k("viewText",e.content)("updatedViewText",e.updateViewText)("disableLinks",!0)}}function ht(n,a){if(n&1&&(d(0,"div",1)(1,"article",2),f(2,mt,1,3,"ViewNoteMarkdown",3),l()()),n&2){let e=m();u(2),b(e.isLoaded()?2:-1)}}var Ge=(()=>{class n{constructor(){this.isLoaded=c(!1),this.hideSkeleton=()=>{this.loadedTimer=setTimeout(()=>{this.isLoaded.set(!0),clearTimeout(this.loadedTimer)},600)}}set text(e){let t=(0,Qe.default)(e??"").body;this.content=We(t),this.hideSkeleton()}ngOnInit(){}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=L({type:n,selectors:[["ViewNoteThumb"]],inputs:{text:"text",updatedViewText:"updatedViewText"},decls:2,vars:2,consts:[["count","1","appearance","line"],["ngClass","box"],["ngClass","viewnote_content viewnote_thumb"],[3,"viewText","updatedViewText","disableLinks"]],template:function(t,o){t&1&&(f(0,ut,1,0,"ngx-skeleton-loader",0),f(1,ht,3,1,"div",1)),t&2&&(b(o.isLoaded()?-1:0),u(),b(o.isLoaded()?1:-1))},dependencies:[A,P,Ie,$e,Fe],styles:[".edit[_ngcontent-%COMP%]{background-color:#f0f8ff;outline:0px solid transparent}.box[_ngcontent-%COMP%]{display:flex;flex-flow:column;max-height:200px;overflow:hidden}.box[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{border:1px dotted grey}.box[_ngcontent-%COMP%]   .row.header[_ngcontent-%COMP%]{flex:0 1 auto}.box[_ngcontent-%COMP%]   .row.content[_ngcontent-%COMP%]{flex:1 1 auto}.box[_ngcontent-%COMP%]   .row.footer[_ngcontent-%COMP%]{flex:0 1 40px}"],changeDetection:0})}}return n})();function pt(n,a){if(n&1){let e=D();d(0,"div",11)(1,"div",12)(2,"input",13),g("change",function(o){y(e);let i=m(3);return x(i.checkboxStatus(o))}),l()()()}if(n&2){let e=m().$implicit;u(2),k("id",se("`input_",e._id,"`"))("value",re(e._id))}}function ft(n,a){if(n&1){let e=D();d(0,"li",1)(1,"div",2)(2,"a",3),g("click",function(){y(e);let o=m(2);return x(o.NoteLinkHandler)}),d(3,"div",4)(4,"div",5),g("click",function(){let o=y(e).$implicit,i=m(2);return x(i.EditLinkHandler(o._id))}),d(5,"mat-card",6)(6,"mat-card-content",7)(7,"div",8),O(8,"ViewNoteThumb",9),l(),d(9,"div",10),p(10),l()()()()()(),f(11,pt,3,4,"div",11),l()()}if(n&2){let e=a.$implicit,t=m(2);u(2),k("routerLink",ae("/notebook/",e.notebook,"/",e._id)),u(2),k("id",e._id),u(4),k("text",e.note),u(2),J(" ",t.dateFormat(e.updatedAt)," "),u(),b(t.onNotesEdit?11:-1)}}function bt(n,a){if(n&1&&(d(0,"ul",0),B(1,ft,12,7,"li",1,j().trackuserNotes,!0),l()),n&2){let e=m();u(),z(e.userNotes())}}var qe=(()=>{class n{constructor(){this.dateFormat=Ae,this.userNotes=c([]),this.isChecked=c([]),this.isSelected=c({selected:[]}),this.injector=M(Y),this.onDestroy$=new F,this.trackuserNotes=(e,t)=>t?t._id:void 0,this.updateCheckbox=(e,t)=>{this.isChecked.update(o=>{let i=[...o],r=this.isChecked()?.findIndex(s=>s.id===e);return r>=0&&i.length>0&&(i[r].selected=t),i}),this.isSelected.update(o=>{let i={selected:[]};return this.isChecked()?.forEach(r=>{r.selected&&i.selected.push(r.id)}),V(I({},o),{selected:i.selected})})},this.checkboxStatus=e=>{let t=e.currentTarget,{checked:o}=t,i=t.value;this.updateCheckbox(i,o)},this.divStatus=e=>{let t=document.getElementById(`input_${e}`),{checked:o}=t,i=t.value;t.checked=!o,o=t.checked,this.updateCheckbox(i,o)},this.NoteLinkHandler=e=>{this.onNotesEdit&&e.preventDefault()},this.EditLinkHandler=e=>{this.onNotesEdit&&this.divStatus(e)}}set notes(e){this.userNotes.set(e);let t=e;if(t){this.userNotes.update(i=>t);let o=[];t.forEach(i=>{this.isChecked.update(r=>{let s={id:i._id,selected:!1};return o.push(s),o})})}}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){Z(this.injector,()=>{this.isSelected$=T(this.isSelected),this.isSelected$.pipe(C(this.onDestroy$)).subscribe(e=>{e&&this.onNotesSelected(e)})}),this.onClearNotesEdit$=H(this.onClearNotesEdit),this.onClearNotesEdit$.pipe(C(this.onDestroy$)).subscribe(e=>{e&&this.isSelected.update(t=>V(I({},t),{selected:[]}))})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=L({type:n,selectors:[["NoteList"]],inputs:{notes:"notes",onNotesSelected:"onNotesSelected",onNotesEdit:"onNotesEdit",onClearNotesEdit:"onClearNotesEdit"},decls:1,vars:1,consts:[["ngClass","notes_list"],["key","{note._id}","ngClass","notebook_list_bg"],["ngClass","thumb_outer"],["ngClass","thumb_outer_link",3,"click","routerLink"],["ngClass","thumb_outer_link"],["ngClass","edit_link",3,"click","id"],["ngClass","note_list_card"],["ngClass","cardcontent"],["ngClass","thumb_image"],[3,"text"],["ngClass","date_format date_format_notes"],["ngClass","thumb_select_outer"],["ngClass","thumb_select"],["type","checkbox","name","Status",3,"change","id","value"]],template:function(t,o){t&1&&f(0,bt,3,0,"ul",0),t&2&&b(o.userNotes()?0:-1)},dependencies:[A,P,ue,ce,ye,we,ve,Ge],styles:[".notes_list[_ngcontent-%COMP%]{list-style:none;margin-block-start:0em;padding-inline-start:0px;padding-left:10px;padding-right:10px}.notes_list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding-top:10px}.notebook_list_bg[_ngcontent-%COMP%]{position:relative}.thumb_select[_ngcontent-%COMP%]{position:absolute;right:10px;top:15px;z-index:1000}.thumb_select_outer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%}.note_list_card[_ngcontent-%COMP%]:hover{background-color:#f7f7f7}.thumb_image[_ngcontent-%COMP%]{min-height:calc(var(--viewnotethumb-box-min-height) * 1px);min-height:45px;max-height:300px;overflow-y:hidden;width:100%;padding:0;margin:0}.thumb_outer_link[_ngcontent-%COMP%]{cursor:pointer;width:100%}.thumb_outer[_ngcontent-%COMP%]{display:flex;width:100%;flex-direction:row;align-items:flex-start;min-height:81px}.thumb_outer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .thumb_outer[_ngcontent-%COMP%]   .edit_link[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})}}return n})();function _t(n,a){n&1&&O(0,"LoadingScreen")}function gt(n,a){if(n&1&&O(0,"NoteList",5),n&2){let e=m(2);k("notes",e.notes())("onNotesSelected",e.updateSelected)("onNotesEdit",e.editNotes())("onClearNotesEdit",e.clearEditNotes())}}function Nt(n,a){if(n&1&&f(0,gt,1,4,"NoteList",5),n&2){let e=m();b(e.notesLoaded()&&e.notebook()&&e.notes()!==null?0:-1)}}function Ct(n,a){if(n&1){let e=D();d(0,"button",6),g("click",function(){y(e);let o=m();return x(o.addNoteFormHandler())}),d(1,"span",7)(2,"span",8),p(3," note_add "),l(),p(4," Add Note "),l()()}}function kt(n,a){if(n&1){let e=D();d(0,"button",9),g("click",function(){y(e);let o=m();return x(o.editNoteFormHandler())}),d(1,"span",7)(2,"span",8),p(3," edit "),l(),p(4," Edit Notes "),l()()}}function wt(n,a){if(n&1){let e=D();d(0,"button",10),g("click",function(){y(e);let o=m();return x(o.deleteNotebookHandler())}),d(1,"span",7)(2,"span",8),p(3," delete "),l(),p(4," Delete Notebook "),l()()}}function vt(n,a){if(n&1){let e=D();d(0,"button",13),g("click",function(){y(e);let o=m(2);return x(o.moveNoteFormHandler())}),d(1,"span",7)(2,"span",8),p(3," flip_to_front "),l(),p(4," Move "),l()()}}function yt(n,a){if(n&1){let e=D();d(0,"button",11),g("click",function(){y(e);let o=m();return x(o.deleteNoteHandler())}),d(1,"span",7)(2,"span",8),p(3," delete "),l(),p(4," Delete "),l()(),f(5,vt,5,0,"button",12)}if(n&2){let e=m();u(5),b(e.userNotebooks()&&e.userNotebooks().length>1?5:-1)}}function xt(n,a){if(n&1){let e=D();d(0,"button",14),g("click",function(){y(e);let o=m();return x(o.cancelEditNoteFormHandler())}),d(1,"span",7)(2,"span",8),p(3," cancel "),l(),p(4," Cancel "),l()()}}var Ke=(()=>{class n{constructor(){this.activatedRoute=M(de),this.authService=M(pe),this.store=M(me),this.router=M(le),this.dialog=M(De),this.notes=c(null),this.notesLoadedDelay=c(!1),this.notesLoadedDelay$=T(this.notesLoadedDelay),this.notesLoaded=c(!1),this.notesLoaded$=T(this.notesLoaded),this.notebookLoaded=c(!1),this.notebookLoaded$=T(this.notebookLoaded),this.notebooksLoaded=c(!1),this.notebooksLoaded$=T(this.notebooksLoaded),this.notebook=c(null),this.userNotebooks=c(null),this.isSelected=c(null),this.moveNote=c(!1),this.enableEditNotebook=c(!1),this.editNotes=c(!1),this.clearEditNotes=c(!1),this.onDestroy$=new F,this.updateContext=e=>{this.loading=e.loading,this.token=e.token},this.showNotification=e=>{this.store.dispatch(he.showNotification({notification:{n_status:"error",title:"Error!",message:e}}))},this.sortNotes=e=>(e.forEach(t=>{t.updatedAt==="No date"&&(t.updatedAt="December 17, 1995 03:24:00")}),e.sort((t,o)=>t.updatedAt!==void 0&&o.updatedAt!==void 0?new Date(t.updatedAt)>new Date(o.updatedAt)?1:-1:t.updatedAt!==void 0?1:-1).reverse(),e),this.loadNotes=()=>h(this,null,function*(){if(!this.notesLoaded()&&this.token&&this.notebookId){this.notesLoadedDelay.set(!1),this.notesLoaded.set(!1);try{let e=yield Re(this.token,this.notebookId);if(this.notebookLoaded.set(!0),e.error){this.showNotification(`${e.error}`);return}if(e.success){let t=this.sortNotes(e.notes);this.notes.set(t),this.notesLoadedDelay.set(!0)}}catch(e){this.showNotification(`${e}`),this.notesLoadedDelay.set(!0);return}}}),this.loadNotebook=()=>h(this,null,function*(){if(!this.notebookLoaded()&&this.token&&this.notebookId){this.notebookLoaded.set(!1);try{let e=yield Ve(this.token,this.notebookId);if(this.notebookLoaded.set(!0),e.error){this.showNotification(`${e.error}`);return}e.success&&(this.notebook.set(e.notebook),this.store.dispatch(R.edited(e.notebook)))}catch(e){this.showNotification(`${e}`),this.notebookLoaded.set(!0);return}}}),this.loadNotebooks=()=>h(this,null,function*(){if(!this.notebooksLoaded()&&this.token){this.notebooksLoaded.set(!1);try{let e=yield Se(this.token);if(this.notebooksLoaded.set(!0),e.error){this.showNotification(`${e.error}`);return}e.success&&this.userNotebooks.set(e.notebooks)}catch(e){this.showNotification(`${e}`),this.notebooksLoaded.set(!0);return}}}),this.updateSelected=e=>{this.isSelected.update(t=>e)},this.moveNoteFormHandler=()=>{this.moveNote.update(e=>!0),this.openSelectNotebookDialog()},this.cancelHandler=()=>{this.moveNote.update(e=>!1),this.dialogRefSelectNotebook.close()},this.cancelEditHandler=()=>{this.enableEditNotebook.update(e=>!1),this.store.dispatch(R.editing({status:!1})),this.dialogRefEditNotebook.close()},this.editNotebookBtnHandler=()=>{this.enableEditNotebook.update(e=>!0),this.openAddNotebookFormDialog()},this.addNoteFormHandler=()=>{this.router.navigate([`/notebook/${this.notebookId}/create-note`])},this.editNoteFormHandler=()=>{this.editNotes.set(!0),this.clearEditNotes.set(!1)},this.resetNotesSelected=()=>{this.isSelected.update(e=>{let t={selected:[]};return V(I({},e),{selected:t.selected})})},this.cancelEditNoteFormHandler=()=>{this.editNotes.set(!1),this.clearEditNotes.set(!0),this.resetNotesSelected()},this.updateNotebookDate=(e,t)=>{this.editNotebookDateHandler(e,t)},this.deleteNoteHandler=()=>h(this,null,function*(){let e;if(this.token&&this.isSelected()!==null&&this.isSelected()!==void 0&&this.isSelected()?.selected!==null){e=this.isSelected().selected;try{let t=yield He(this.token,e);if(this.notebookLoaded.set(!0),t.error){this.showNotification(`${t.error}`);return}if(t.success){let o,i=this.notes()[0].updatedAt;if(this.notes.update(r=>{let s,N=[];if(r){s=[...r];let $=s.length;for(;$--;){var E=s[$];e.indexOf(E._id)===-1&&N.push(E)}let S=N.reverse();return S.length>0&&(o=S[0].updatedAt),S}else return null}),o!==void 0&&this.notebookId!==void 0&&i&&new Date(o).getTime()!==new Date(i).getTime()){let r=String(this.notebookId);this.updateNotebookDate(r,o)}this.cancelEditNoteFormHandler()}}catch(t){this.showNotification(`${t}`);return}}}),this.editNotebookDateHandler=(e,t)=>h(this,null,function*(){if(this.token&&e&&t)try{let o=yield je(this.token,e,t);if(o.error){this.showNotification(`${o.error}`);return}o.success}catch(o){this.showNotification(`${o}`);return}}),this.deleteNotebookHandler=()=>h(this,null,function*(){let e=this.notebook()._id;if(this.token&&e&&e.length>0)try{let t=yield Be(this.token,e);if(t.error){this.showNotification(`${t.error}`);return}t.success&&this.router.navigate(["/notebooks"])}catch(t){this.showNotification(`${t}`);return}}),this.editNotebookHandler=(e,t,o,i)=>h(this,null,function*(){if(this.token&&e&&t&&o&&i)try{let r=yield ze(this.token,e,t,o,i);if(r.error){this.showNotification(`${r.error}`);return}r.success&&(this.notebook.update(s=>r.notebook_edited),this.store.dispatch(R.editing({status:!1})),this.store.dispatch(R.edited(r.notebook_edited)),this.enableEditNotebook.update(s=>!1))}catch(r){this.showNotification(`${r}`);return}}),this.getLatestUpdated=e=>{let t=[];for(let r in e)if(this.notes()!==null){var o=this.notes().filter(s=>s._id===e[r]);t.push(o[0])}return this.sortNotes(t)[0].updatedAt},this.moveNoteHandler=e=>h(this,null,function*(){let t;if(this.token&&e&&this.isSelected()!==null&&this.isSelected()!==void 0&&this.isSelected()?.selected!==null){t=this.isSelected().selected;let o=this.getLatestUpdated(t);try{let i=yield Je(this.token,e,t,o);if(i.error){this.showNotification(`${i.error}`);return}if(i.success){let r;if(this.notes.update(s=>{let N,E=[];if(s){N=[...s];let S=N.length;for(;S--;){var $=N[S];t.indexOf($._id)===-1&&E.push($)}let G=E.reverse();return G.length>0&&(r=G[0].updatedAt),G}else return null}),r!==void 0&&this.notebookId!==void 0){let s=String(this.notebookId);this.updateNotebookDate(s,r)}this.moveNote.update(s=>!1),this.cancelEditNoteFormHandler()}}catch(i){this.showNotification(`${i}`);return}}})}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.activatedRoute.params.pipe(C(this.onDestroy$)).subscribe(e=>{this.notebookId=e.notebookId}),this.authService.authContext$.pipe(C(this.onDestroy$)).subscribe(e=>{this.updateContext(e)}),this.store.select(fe).pipe(C(this.onDestroy$)).subscribe(e=>{e.status===!0&&this.editNotebookBtnHandler()}),this.notesLoadedDelay$.pipe(C(this.onDestroy$)).subscribe(e=>{e&&(this.loadingTimer=setTimeout(()=>{this.notesLoaded.set(!0),clearTimeout(this.loadingTimer)},100))}),this.notesLoaded$.pipe(C(this.onDestroy$)).subscribe(e=>{e||this.loadNotes()}),this.notebookLoaded$.pipe(C(this.onDestroy$)).subscribe(e=>{e||this.loadNotebook()}),this.notebooksLoaded$.pipe(C(this.onDestroy$)).subscribe(e=>{e||this.loadNotebooks()})}openSelectNotebookDialog(){let e=new q;e.disableClose=!0,e.autoFocus=!0,e.data={notebooks:this.userNotebooks(),onCancel:this.cancelHandler,moveNotes:this.moveNoteHandler,notebookId:this.notebookId},this.dialogRefSelectNotebook=this.dialog.open(Ue,e)}openAddNotebookFormDialog(){let e=new q;e.disableClose=!0,e.autoFocus=!0,e.data={notebook:this.notebook(),method:"edit",editNotebook:this.editNotebookHandler,onCancel:this.cancelEditHandler},this.dialogRefEditNotebook=this.dialog.open(Oe,e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=L({type:n,selectors:[["Notebook"]],decls:9,vars:7,consts:[["ngClass","page_scrollable_header_breadcrumb_footer_list"],["mat-button","","color","secondary","aria-label","Add note button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Edit Notes button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Delete Notebook button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Cancel Note button","ngClass","contained medium breadcrumb_edit_fab button_fab"],[3,"notes","onNotesSelected","onNotesEdit","onClearNotesEdit"],["mat-button","","color","secondary","aria-label","Add note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["ngClass","icon_text"],["ngClass","material-symbols-outlined button_icon white"],["mat-button","","color","secondary","aria-label","Edit Notes button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Delete Notebook button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Delete Note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Move Note button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Move Note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Cancel Note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"]],template:function(t,o){t&1&&(f(0,_t,1,0,"LoadingScreen"),d(1,"div",0),f(2,Nt,1,1),l(),d(3,"Footer"),f(4,Ct,5,0,"button",1),f(5,kt,5,0,"button",2),f(6,wt,5,0,"button",3),f(7,yt,6,1),f(8,xt,5,0,"button",4),l()),t&2&&(b(!o.notebookLoaded()||!o.notesLoaded()?0:-1),u(2),b(o.notebookLoaded()&&o.notesLoaded()&&o.notebook()&&o.notes()?2:-1),u(2),b(o.notebookLoaded()&&o.notesLoaded()&&!o.editNotes()?4:-1),u(),b(o.notebookLoaded()&&o.notesLoaded()&&!o.editNotes()&&o.notes()&&o.notes().length>0?5:-1),u(),b(o.notebookLoaded()&&o.notesLoaded()&&o.notes()&&o.notes().length<1?6:-1),u(),b(o.notebookLoaded()&&o.notesLoaded()&&o.editNotes()&&o.isSelected()&&o.isSelected().selected.length>0?7:-1),u(),b(o.notebookLoaded()&&o.notesLoaded()&&o.editNotes()?8:-1))},dependencies:[A,P,W,U,Q,xe,Pe,qe],encapsulation:2,changeDetection:0})}}return n})();var wn=[{path:"",component:Ke}];export{wn as notebookRoutes};
