import{a as q,b as B,c as X,f as J}from"./chunk-Y7BJSR4Q.js";import{a as Y}from"./chunk-B5RC25IS.js";import{D as G,oa as Q,qa as j,r as L,ra as b,sa as E,ta as R,ua as z,wa as W}from"./chunk-7OUEVMB7.js";import{j as O,o as S}from"./chunk-7QZQAXAI.js";import{$b as x,Fb as p,Gb as h,Jb as N,Kb as i,Lb as s,Mb as T,Qb as k,Rb as D,Tb as g,V as A,Vb as u,Zb as H,_b as U,a as d,ab as a,b as c,ea as I,ec as m,fc as V,h as C,hc as F,l as M,la as w,lb as $,ma as P,pb as y,xa as v}from"./chunk-5HUWBQGC.js";var ne=b,K=(o,f)=>C(null,null,function*(){let e;try{if(e=yield fetch(R.APP_API_ENDPOINT+"api/auth/change-password",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(f)}),e.status===404)throw new Error(`${e.url} Not Found.`);if(e.status===401)throw new Error("Unauthorized")}catch(r){return{error:E(r)}}let t;try{if(t=yield e.json(),t===null)return{error:`${ne.CHANGE_PASS_ERROR}`}}catch(r){return{error:E(r)}}return t.error?{error:t.error}:t});var ie=b,Z=(o,f)=>C(null,null,function*(){let e;try{if(e=yield fetch(R.APP_API_ENDPOINT+"api/auth/change-username",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(f)}),e.status===404)throw new Error(`${e.url} Not Found.`);if(e.status===401)throw new Error("Unauthorized")}catch(r){return{error:E(r)}}let t;try{if(t=yield e.json(),t===null)return{error:`${ie.CHANGE_USER_ERROR}`}}catch(r){return{error:E(r)}}return t.error?{error:t.error}:t});var ae=["oldPasswordRef"],le=["newPasswordRef"],me=["newUsernameRef"],de=["errorcontainer"];function ce(o,f){if(o&1){let e=D();i(0,"div",7)(1,"form",8),g("ngSubmit",function(r){w(e);let n=u();return P(n.submitHandlerPassword(r))}),i(2,"div",9)(3,"label",10),m(4,"New Password"),s(),i(5,"input",11,0),g("change",function(r){w(e);let n=u();return P(n.handleChangePassword(r))}),s()(),i(7,"div",9)(8,"label",12),m(9,"Old Password"),s(),i(10,"input",13,1),g("change",function(r){w(e);let n=u();return P(n.handleChangePassword(r))}),s()(),i(12,"div",14)(13,"button",15),m(14," Change Password "),s()()()()}if(o&2){let e=u();a(13),N("disabled",F(!e.formIsValid()))}}function ue(o,f){if(o&1){let e=D();i(0,"div",7)(1,"form",8),g("ngSubmit",function(r){w(e);let n=u();return P(n.submitHandlerUsername(r))}),i(2,"div",9)(3,"label",16),m(4,"User Name"),s(),i(5,"input",17,2),g("input",function(r){w(e);let n=u();return P(n.handleChangeUsername(r))}),s()(),i(7,"div",14)(8,"button",18),m(9," Change User Name "),s()()()()}if(o&2){let e=u();a(5),N("defaultValue",e.username()),a(3),N("disabled",F(!e.formIsValid()))}}function fe(o,f){o&1&&k(0,null,3)}var l=b,te=(()=>{class o{constructor(){this.username=v(""),this.userNameToggle=v(!1),this.passwordToggle=v(!1),this.formIsValid=v(!1),this.error=v({error_state:!1,error_severity:"",message:""}),this.error$=L(this.error),this.onDestroy$=new M,this.resetError=()=>{this.componentRef&&this.componentRef.destroy(),this.formIsValid.set(!0),this.error.update(e=>c(d({},e),{error_state:!1,error_severity:"",message:""}))},this.handleChangeUsername=e=>{this.resetError();let t=e.currentTarget;t.value.length<l.USERNAME_MIN||t.value===void 0?(this.formIsValid.set(!1),this.error.update(r=>c(d({},r),{error_state:!0,error_severity:"warning",message:l.CHANGE_USER_TOO_FEW}))):t.value.length>l.USERNAME_MAX?(this.formIsValid.set(!1),this.error.update(r=>c(d({},r),{error_state:!0,error_severity:"warning",message:l.CHANGE_USER_TOO_MANY}))):t.value===this.username()?(this.formIsValid.set(!1),this.error.update(r=>c(d({},r),{error_state:!0,error_severity:"warning",message:l.CHANGE_USER_UNIQUE}))):this.resetError()},this.handleChangePassword=e=>{this.resetError();let t=e.currentTarget,r=this.oldPasswordRef.nativeElement.value,n=this.newPasswordRef.nativeElement.value;r.length<l.PASSWORD_MIN||n.length<l.PASSWORD_MIN?(this.formIsValid.set(!1),this.error.update(_=>c(d({},_),{error_state:!0,error_severity:"warning",message:l.CHANGE_PASS_TOO_FEW}))):r.length>l.PASSWORD_MAX||n.length>l.PASSWORD_MAX?(this.formIsValid.set(!1),this.error.update(_=>c(d({},_),{error_state:!0,error_severity:"warning",message:l.CHANGE_PASS_TOO_MANY}))):r&&n&&r===n?(this.formIsValid.set(!1),this.error.update(_=>c(d({},_),{error_state:!0,error_severity:"warning",message:l.CHANGE_PASS_UNIQUE}))):r.length!==n.length?(this.formIsValid.set(!1),this.error.update(_=>c(d({},_),{error_state:!0,error_severity:"warning",message:l.CHANGE_PASS_LENGTH}))):this.resetError()},this.submitHandlerUsername=e=>{e.preventDefault();let t=this.newUsernameRef.nativeElement.value;t&&(this.onChangeUsername({newUsername:t}),this.resetToggle())},this.submitHandlerPassword=e=>{e.preventDefault();let t=this.oldPasswordRef.nativeElement?.value,r=this.newPasswordRef.nativeElement?.value;!t||!r||(this.onChangePassword({oldPassword:t,newPassword:r}),this.resetToggle())},this.resetToggle=()=>{this.resetError(),this.userNameToggle.update(e=>!1),this.passwordToggle.update(e=>!1)},this.toggleUserName=()=>{this.resetError(),this.userNameToggle.update(e=>!e),this.passwordToggle.update(e=>!1)},this.togglePassword=()=>{this.resetError(),this.passwordToggle.update(e=>!e),this.userNameToggle.update(e=>!1)}}set userName(e){this.username.set(e)}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.error$.pipe(A(this.onDestroy$)).subscribe(e=>{e.error_state&&this.addErrorComponent()})}addErrorComponent(){import("./chunk-NTU5ROOD.js").then(e=>{let t=e.LazyLoadedModule.components.dynamicComponent;this.componentRef=this.errorcontainer.createComponent(t),this.componentRef.instance.error_state=this.error().error_state,this.componentRef.instance.error_severity=this.error().error_severity,this.componentRef.instance.message=this.error().message})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=y({type:o,selectors:[["ProfileForm"]],viewQuery:function(t,r){if(t&1&&H(ae,5)(le,5)(me,5)(de,5,$),t&2){let n;U(n=x())&&(r.oldPasswordRef=n.first),U(n=x())&&(r.newPasswordRef=n.first),U(n=x())&&(r.newUsernameRef=n.first),U(n=x())&&(r.errorcontainer=n.first)}},inputs:{userName:"userName",onChangePassword:"onChangePassword",onChangeUsername:"onChangeUsername"},decls:8,vars:3,consts:[["newPasswordRef",""],["oldPasswordRef",""],["newUsernameRef",""],["errorcontainer",""],["ngClass","change_buttons"],["mat-button","","color","secondary","aria-label","User Name button","ngClass","contained medium",3,"click"],["mat-button","","color","secondary","aria-label","Password button","ngClass","contained medium",3,"click"],["ngClass","form_container"],["ngClass","form",3,"ngSubmit"],["ngClass","control"],["htmlFor","new-password"],["autoComplete","New Password","type","password","id","new-password",3,"change"],["htmlFor","old-password"],["autoComplete","New User Name","type","password","id","old-password",3,"change"],["ngClass","action"],["mat-button","","color","secondary","aria-label","Change Password button","ngClass","contained medium",3,"disabled"],["htmlFor","new-username"],["type","text","id","new-password",3,"input","defaultValue"],["mat-button","","color","secondary","aria-label","Change User Name button","ngClass","contained medium",3,"disabled"]],template:function(t,r){t&1&&(i(0,"div",4)(1,"button",5),g("click",function(){return r.toggleUserName()}),m(2," User Name "),s(),i(3,"button",6),g("click",function(){return r.togglePassword()}),m(4," Password "),s()(),p(5,ce,15,2,"div",7),p(6,ue,10,3,"div",7),p(7,fe,2,0,"ng-container")),t&2&&(a(5),h(r.passwordToggle()?5:-1),a(),h(r.userNameToggle()?6:-1),a(),h(r.error().error_state?7:-1))},dependencies:[S,O,J,X,q,B,j,Q],styles:[".form[_ngcontent-%COMP%]{margin:1.5rem auto}.control[_ngcontent-%COMP%]{margin-bottom:.5rem}.control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:.5rem;color:#353336;display:block}.control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:block;font:inherit;width:100%;border-radius:4px;border:1px solid #38015c;padding:.25rem;background-color:#f7f0fa}.action[_ngcontent-%COMP%]{margin-top:1.5rem}.change_buttons[_ngcontent-%COMP%], .form_container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-content:center;justify-content:center;flex-wrap:wrap;gap:20px;margin-top:20px}"]})}}return o})();function pe(o,f){o&1&&T(0,"LoadingScreen")}function he(o,f){o&1&&m(0," Unauthorized ")}function ge(o,f){if(o&1&&(i(0,"section",1)(1,"h2"),m(2),s(),i(3,"h3"),m(4),s(),T(5,"ProfileForm",2),s()),o&2){let e=u();a(2),V(e.details.username),a(2),V(e.details.email),a(),N("userName",e.details.username)("onChangePassword",e.changePasswordHandler)("onChangeUsername",e.changeUsernameHandler)}}var re=(()=>{class o{constructor(){this.authService=I(W),this.store=I(G),this.onDestroy$=new M,this.updateContext=e=>{this.loading=e.loading,this.token=e.token,this.success=e.success,this.details=e.details,this.onLogout=e.onLogout},this.showNotification=e=>{this.store.dispatch(z.showNotification({notification:{n_status:"error",title:"Error!",message:e}}))},this.changePasswordHandler=e=>C(this,null,function*(){if(this.token)try{let t=yield K(this.token,e);if(t.error){this.showNotification(`${t.error}`);return}t.success}catch(t){this.showNotification(`${t}`);return}}),this.changeUsernameHandler=e=>C(this,null,function*(){if(this.token)try{let t=yield Z(this.token,e);if(t.error){this.showNotification(`${t.error}`);return}if(t.error==="Unauthorized"){this.onLogout&&this.onLogout();return}t.success&&this.authService.authContext.update(r=>c(d({},r),{success:t.success,details:t.details,loading:!1}))}catch(t){this.showNotification(`${t}`);return}})}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.authService.authContext$.pipe(A(this.onDestroy$)).subscribe(e=>{this.updateContext(e)})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=y({type:o,selectors:[["UserProfile"]],decls:4,vars:3,consts:[["ngClass","page_scrollable_header_breadcrumb_list"],["ngClass","profile"],[3,"userName","onChangePassword","onChangeUsername"]],template:function(t,r){t&1&&(i(0,"div",0),p(1,pe,1,0,"LoadingScreen"),p(2,he,1,0),p(3,ge,6,5,"section",1),s()),t&2&&(a(),h(r.success?-1:1),a(),h(r.success&&!r.token?2:-1),a(),h(r.success&&r.token&&r.details?3:-1))},dependencies:[S,O,Y,te],styles:[".profile[_ngcontent-%COMP%]{margin:3rem auto;text-align:center;display:flex;overflow-y:visible;flex-direction:column;align-items:center}"]})}}return o})();var oe=(()=>{class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=y({type:o,selectors:[["Profile"]],decls:1,vars:0,template:function(t,r){t&1&&T(0,"UserProfile")},dependencies:[S,re],encapsulation:2})}}return o})();var nt=[{path:"",component:oe}];export{nt as profileRoutes};
