import{a as ee,h as te}from"./chunk-322FMVNF.js";import{B as q,C as B,H as X,T as J,U as Y,V as K,_ as Z,n as H,p as S,q as b,r as I,s as z,v as W}from"./chunk-4KA7YYCZ.js";import{$b as u,Ba as v,Lb as h,Mb as g,Pb as N,Qb as i,Rb as s,Sb as E,Wb as L,Xb as V,Y as x,Zb as _,Zc as R,a as d,b as c,cd as Q,db as a,dc as G,ea as A,ec as T,fc as M,j as C,mb as D,n as U,nc as m,ob as j,oc as $,pa as w,qa as P,qc as k,sb as y,tb as O}from"./chunk-AS4DOYW2.js";var le=b,re=(n,f)=>C(null,null,function*(){let e;try{if(e=yield fetch(I.APP_API_ENDPOINT+"api/auth/change-password",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(f)}),e.status===404)throw new Error(`${e.url} Not Found.`);if(e.status===401)throw new Error("Unauthorized")}catch(t){return{error:S(t)}}let r;try{if(r=yield e.json(),r===null)return{error:`${le.CHANGE_PASS_ERROR}`}}catch(t){return{error:S(t)}}return r.error?{error:r.error}:r});var me=b,oe=(n,f)=>C(null,null,function*(){let e;try{if(e=yield fetch(I.APP_API_ENDPOINT+"api/auth/change-username",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(f)}),e.status===404)throw new Error(`${e.url} Not Found.`);if(e.status===401)throw new Error("Unauthorized")}catch(t){return{error:S(t)}}let r;try{if(r=yield e.json(),r===null)return{error:`${me.CHANGE_USER_ERROR}`}}catch(t){return{error:S(t)}}return r.error?{error:r.error}:r});var ce=["oldPasswordRef"],ue=["newPasswordRef"],fe=["newUsernameRef"],pe=["errorcontainer"];function he(n,f){if(n&1){let e=V();i(0,"div",7)(1,"form",8),_("ngSubmit",function(t){w(e);let o=u();return P(o.submitHandlerPassword(t))}),i(2,"div",9)(3,"label",10),m(4,"New Password"),s(),i(5,"input",11,0),_("change",function(t){w(e);let o=u();return P(o.handleChangePassword(t))}),s()(),i(7,"div",9)(8,"label",12),m(9,"Old Password"),s(),i(10,"input",13,1),_("change",function(t){w(e);let o=u();return P(o.handleChangePassword(t))}),s()(),i(12,"div",14)(13,"button",15),m(14," Change Password "),s()()()()}if(n&2){let e=u();a(13),N("disabled",k(!e.formIsValid()))}}function ge(n,f){if(n&1){let e=V();i(0,"div",7)(1,"form",8),_("ngSubmit",function(t){w(e);let o=u();return P(o.submitHandlerUsername(t))}),i(2,"div",9)(3,"label",16),m(4,"User Name"),s(),i(5,"input",17,2),_("input",function(t){w(e);let o=u();return P(o.handleChangeUsername(t))}),s()(),i(7,"div",14)(8,"button",18),m(9," Change User Name "),s()()()()}if(n&2){let e=u();a(5),N("defaultValue",e.username()),a(3),N("disabled",k(!e.formIsValid()))}}function _e(n,f){n&1&&L(0,null,3)}var l=b,ne=(()=>{class n{constructor(){this.username=v(""),this.userNameToggle=v(!1),this.passwordToggle=v(!1),this.formIsValid=v(!1),this.error=v({error_state:!1,error_severity:"",message:""}),this.error$=z(this.error),this.onDestroy$=new U,this.resetError=()=>{this.componentRef&&this.componentRef.destroy(),this.formIsValid.set(!0),this.error.update(e=>c(d({},e),{error_state:!1,error_severity:"",message:""}))},this.handleChangeUsername=e=>{this.resetError();let r=e.currentTarget;r.value.length<l.USERNAME_MIN||r.value===void 0?(this.formIsValid.set(!1),this.error.update(t=>c(d({},t),{error_state:!0,error_severity:"warning",message:l.CHANGE_USER_TOO_FEW}))):r.value.length>l.USERNAME_MAX?(this.formIsValid.set(!1),this.error.update(t=>c(d({},t),{error_state:!0,error_severity:"warning",message:l.CHANGE_USER_TOO_MANY}))):r.value===this.username()?(this.formIsValid.set(!1),this.error.update(t=>c(d({},t),{error_state:!0,error_severity:"warning",message:l.CHANGE_USER_UNIQUE}))):this.resetError()},this.handleChangePassword=e=>{this.resetError();let r=e.currentTarget,t=this.oldPasswordRef.nativeElement.value,o=this.newPasswordRef.nativeElement.value;t.length<l.PASSWORD_MIN||o.length<l.PASSWORD_MIN?(this.formIsValid.set(!1),this.error.update(p=>c(d({},p),{error_state:!0,error_severity:"warning",message:l.CHANGE_PASS_TOO_FEW}))):t.length>l.PASSWORD_MAX||o.length>l.PASSWORD_MAX?(this.formIsValid.set(!1),this.error.update(p=>c(d({},p),{error_state:!0,error_severity:"warning",message:l.CHANGE_PASS_TOO_MANY}))):t&&o&&t===o?(this.formIsValid.set(!1),this.error.update(p=>c(d({},p),{error_state:!0,error_severity:"warning",message:l.CHANGE_PASS_UNIQUE}))):t.length!==o.length?(this.formIsValid.set(!1),this.error.update(p=>c(d({},p),{error_state:!0,error_severity:"warning",message:l.CHANGE_PASS_LENGTH}))):this.resetError()},this.submitHandlerUsername=e=>{e.preventDefault();let r=this.newUsernameRef.nativeElement.value;r&&(this.onChangeUsername({newUsername:r}),this.resetToggle())},this.submitHandlerPassword=e=>{e.preventDefault();let r=this.oldPasswordRef.nativeElement?.value,t=this.newPasswordRef.nativeElement?.value;!r||!t||(this.onChangePassword({oldPassword:r,newPassword:t}),this.resetToggle())},this.resetToggle=()=>{this.resetError(),this.userNameToggle.update(e=>!1),this.passwordToggle.update(e=>!1)},this.toggleUserName=()=>{this.resetError(),this.userNameToggle.update(e=>!e),this.passwordToggle.update(e=>!1)},this.togglePassword=()=>{this.resetError(),this.passwordToggle.update(e=>!e),this.userNameToggle.update(e=>!1)}}set userName(e){this.username.set(e)}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.error$.pipe(x(this.onDestroy$)).subscribe(e=>{e.error_state&&this.addErrorComponent()})}addErrorComponent(){import("./chunk-IFURLEYA.js").then(e=>{let r=e.LazyLoadedModule.components.dynamicComponent;this.componentRef=this.errorcontainer.createComponent(r),this.componentRef.instance.error_state=this.error().error_state,this.componentRef.instance.error_severity=this.error().error_severity,this.componentRef.instance.message=this.error().message})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=y({type:n,selectors:[["ProfileForm"]],viewQuery:function(r,t){if(r&1&&G(ce,5)(ue,5)(fe,5)(pe,5,j),r&2){let o;T(o=M())&&(t.oldPasswordRef=o.first),T(o=M())&&(t.newPasswordRef=o.first),T(o=M())&&(t.newUsernameRef=o.first),T(o=M())&&(t.errorcontainer=o.first)}},inputs:{userName:"userName",onChangePassword:"onChangePassword",onChangeUsername:"onChangeUsername"},standalone:!1,decls:8,vars:3,consts:[["newPasswordRef",""],["oldPasswordRef",""],["newUsernameRef",""],["errorcontainer",""],["ngClass","change_buttons"],["mat-button","","color","secondary","aria-label","User Name button","ngClass","contained medium",3,"click"],["mat-button","","color","secondary","aria-label","Password button","ngClass","contained medium",3,"click"],["ngClass","form_container"],["ngClass","form",3,"ngSubmit"],["ngClass","control"],["htmlFor","new-password"],["autoComplete","New Password","type","password","id","new-password",3,"change"],["htmlFor","old-password"],["autoComplete","New User Name","type","password","id","old-password",3,"change"],["ngClass","action"],["mat-button","","color","secondary","aria-label","Change Password button","ngClass","contained medium",3,"disabled"],["htmlFor","new-username"],["type","text","id","new-password",3,"input","defaultValue"],["mat-button","","color","secondary","aria-label","Change User Name button","ngClass","contained medium",3,"disabled"]],template:function(r,t){r&1&&(i(0,"div",4)(1,"button",5),_("click",function(){return t.toggleUserName()}),m(2," User Name "),s(),i(3,"button",6),_("click",function(){return t.togglePassword()}),m(4," Password "),s()(),h(5,he,15,2,"div",7),h(6,ge,10,3,"div",7),h(7,_e,2,0,"ng-container")),r&2&&(a(5),g(t.passwordToggle()?5:-1),a(),g(t.userNameToggle()?6:-1),a(),g(t.error().error_state?7:-1))},dependencies:[R,X,K,J,Y],styles:[".form[_ngcontent-%COMP%]{margin:1.5rem auto}.control[_ngcontent-%COMP%]{margin-bottom:.5rem}.control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:.5rem;color:#353336;display:block}.control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:block;font:inherit;width:100%;border-radius:4px;border:1px solid #38015c;padding:.25rem;background-color:#f7f0fa}.action[_ngcontent-%COMP%]{margin-top:1.5rem}.change_buttons[_ngcontent-%COMP%], .form_container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-content:center;justify-content:center;flex-wrap:wrap;gap:20px;margin-top:20px}"]})}}return n})();function we(n,f){n&1&&E(0,"LoadingScreen")}function Pe(n,f){n&1&&m(0," Unauthorized ")}function ve(n,f){if(n&1&&(i(0,"section",1)(1,"h2"),m(2),s(),i(3,"h3"),m(4),s(),E(5,"ProfileForm",2),s()),n&2){let e=u();a(2),$(e.details.username),a(2),$(e.details.email),a(),N("userName",e.details.username)("onChangePassword",e.changePasswordHandler)("onChangeUsername",e.changeUsernameHandler)}}var ie=(()=>{class n{constructor(e,r){this.authService=e,this.store=r,this.onDestroy$=new U,this.updateContext=t=>{this.loading=t.loading,this.token=t.token,this.success=t.success,this.details=t.details,this.onLogout=t.onLogout},this.showNotification=t=>{this.store.dispatch(q.showNotification({notification:{n_status:"error",title:"Error!",message:t}}))},this.changePasswordHandler=t=>C(this,null,function*(){if(this.token)try{let o=yield re(this.token,t);if(o.error){this.showNotification(`${o.error}`);return}o.success}catch(o){this.showNotification(`${o}`);return}}),this.changeUsernameHandler=t=>C(this,null,function*(){if(this.token)try{let o=yield oe(this.token,t);if(o.error){this.showNotification(`${o.error}`);return}if(o.error==="Unauthorized"){this.onLogout&&this.onLogout();return}o.success&&this.authService.authContext.update(p=>c(d({},p),{success:o.success,details:o.details,loading:!1}))}catch(o){this.showNotification(`${o}`);return}})}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.authService.authContext$.pipe(x(this.onDestroy$)).subscribe(e=>{this.updateContext(e)})}static{this.\u0275fac=function(r){return new(r||n)(D(B),D(W))}}static{this.\u0275cmp=y({type:n,selectors:[["UserProfile"]],standalone:!1,decls:4,vars:3,consts:[["ngClass","page_scrollable_header_breadcrumb_list"],["ngClass","profile"],[3,"userName","onChangePassword","onChangeUsername"]],template:function(r,t){r&1&&(i(0,"div",0),h(1,we,1,0,"LoadingScreen"),h(2,Pe,1,0),h(3,ve,6,5,"section",1),s()),r&2&&(a(),g(t.success?-1:1),a(),g(t.success&&!t.token?2:-1),a(),g(t.success&&t.token&&t.details?3:-1))},dependencies:[R,ee,ne],styles:[".profile[_ngcontent-%COMP%]{margin:3rem auto;text-align:center;display:flex;overflow-y:visible;flex-direction:column;align-items:center}"]})}}return n})();var se=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=y({type:n,selectors:[["Profile"]],standalone:!1,decls:1,vars:0,template:function(r,t){r&1&&E(0,"UserProfile")},dependencies:[ie],encapsulation:2})}}return n})();var Ne=[{path:"",component:se}],ae=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=O({type:n})}static{this.\u0275inj=A({imports:[H.forChild(Ne),H]})}}return n})();var ut=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=O({type:n})}static{this.\u0275inj=A({imports:[Q,ae,te,Z]})}}return n})();export{ut as ProfileModule};
