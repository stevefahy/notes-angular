import{a as G,b as Q,c as H,f as Y}from"./chunk-S3FOCIPD.js";import{a as j,b as z,c as B,d as W}from"./chunk-TB2NPGND.js";import{k as T,oa as U,q as x,qa as k,r as F,ra as $,wa as q}from"./chunk-KMYELJ2F.js";import{Db as w,Eb as b,Hb as u,Ib as a,Jb as l,Jc as N,Ob as S,Oc as O,Pb as y,Rb as g,Tb as A,U as P,Xb as D,Yb as f,Zb as _,_a as s,cc as p,da as v,dc as V,ec as E,g as I,jb as R,k as L,ka as d,la as c,nb as M,wa as C}from"./chunk-XGJ3VW6B.js";var X=["usernameInputRef"],Z=["emailInputRef"],ee=["passwordInputRef"],te=["errorcontainer"];function re(m,K){if(m&1){let t=y();a(0,"div")(1,"div",4)(2,"label",12),p(3,"Your Name"),l(),a(4,"input",13,2),g("input",function(){d(t);let e=A();return c(e.resetError())}),l()()()}m&2&&(s(),u("ngClass","control"))}function ne(m,K){m&1&&S(0,null,3)}var h=$,J=(()=>{class m{constructor(){this.authService=v(q),this.router=v(T),this.isLogin=C(!0),this.isSubmitting=C(!1),this.error=C({error_state:!1,error_severity:"",message:""}),this.error$=F(this.error),this.onDestroy$=new L,this.componentAdded=!1,this.updateContext=t=>{this.onLogin=t.onLogin,this.onRegister=t.onRegister},this.switchAuthModeHandler=()=>{this.isLogin.update(t=>!t),this.resetError()},this.resetError=()=>{this.error.set({error_state:!1,message:""}),this.isSubmitting.set(!1)},this.validateForm=t=>{if(t.includes("username")&&this.usernameInputRef.nativeElement.value.length<2)return this.usernameInputRef.nativeElement.focus(),this.error.set({error_state:!0,message:h.SIGNUP_INVALID_USERNAME}),!1;if(t.includes("email")){let r=this.emailInputRef.nativeElement.value;if(!r||!r.includes("@")||!r.includes("."))return this.emailInputRef.nativeElement.focus(),this.error.set({error_state:!0,message:h.SIGNUP_INVALID_EMAIL}),!1}if(t.includes("password")){let r=this.passwordInputRef.nativeElement.value;if(!r||r.trim().length<7)return this.passwordInputRef.nativeElement.focus(),this.error.set({error_state:!0,message:h.SIGNUP_INVALID_PASSWORD}),!1}return!0},this.submitHandler=t=>I(this,null,function*(){t.preventDefault(),this.error.set({error_state:!1,message:""}),this.isSubmitting.set(!0);let r=this.emailInputRef.nativeElement.value,e=this.passwordInputRef.nativeElement.value;if(this.isLogin()){if(!this.validateForm(["email","password"]))return;try{let i=yield this.onLogin(r,e);if(i&&i===void 0||i&&i.error){i.error||(i.error="Unauthorised"),this.error.set({error_state:!0,message:i.error});return}else this.router.navigate([`${h.DEFAULT_PAGE}`])}catch(i){this.error.set({error_state:!0,message:i.message})}}else{let n=this.usernameInputRef.nativeElement.value;if(!this.validateForm(["username","email","password"]))return;try{let o=yield this.onRegister(n,r,e,"angular");if(this.isSubmitting.set(!1),o==null){this.router.navigate([`${h.DEFAULT_PAGE}`]);return}if(o.error){this.error.set({error_state:!0,message:o.error});return}o.success&&o.notebookID&&o.noteID?this.router.navigate([`/notebook/${o.notebookID}/${o.noteID}`]):this.router.navigate([`${h.DEFAULT_PAGE}`])}catch(o){this.error.set({error_state:!0,message:o.message})}}})}ngOnDestroy(){this.sub.unsubscribe(),this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.sub=this.authService.authContext$.subscribe({next:t=>{this.updateContext(t)}}),this.error$.pipe(P(this.onDestroy$)).subscribe(t=>{t.error_state&&this.addErrorComponent()})}addErrorComponent(){this.isSubmitting.set(!0),import("./chunk-GASE2SWZ.js").then(t=>{let r=t.LazyLoadedModule.components.dynamicComponent,e=this.errorcontainer.createComponent(r);e.instance.error_state=this.error().error_state,e.instance.error_severity=this.error().error_severity,e.instance.message=this.error().message})}static{this.\u0275fac=function(r){return new(r||m)}}static{this.\u0275cmp=M({type:m,selectors:[["LoginPage"]],viewQuery:function(r,e){if(r&1&&D(X,5)(Z,5)(ee,5)(te,5,R),r&2){let n;f(n=_())&&(e.usernameInputRef=n.first),f(n=_())&&(e.emailInputRef=n.first),f(n=_())&&(e.passwordInputRef=n.first),f(n=_())&&(e.errorcontainer=n.first)}},decls:23,vars:13,consts:[["emailInputRef",""],["passwordInputRef",""],["usernameInputRef",""],["errorcontainer",""],[3,"ngClass"],["novalidate",""],["htmlFor","email"],["type","email","id","email","required","","placeholder","Email","autoComplete","email",3,"change","input"],["htmlFor","password"],["type","password","id","password","required","","placeholder","Password","autoComplete","current-password",3,"change","input"],["mat-button","","color","secondary",3,"click","ngClass","disabled"],["mat-button","",3,"click","ngClass"],["htmlFor","username"],["type","text","id","username","required","","placeholder","Username","autoComplete","username",3,"input"]],template:function(r,e){if(r&1){let n=y();a(0,"section",4)(1,"mat-card")(2,"mat-card-content")(3,"mat-card-header",4),p(4),l(),a(5,"form",5),w(6,re,6,1,"div"),a(7,"div",4)(8,"label",6),p(9,"Your Email"),l(),a(10,"input",7,0),g("change",function(){return d(n),c(e.resetError())})("input",function(){return d(n),c(e.resetError())}),l()(),a(12,"div",4)(13,"label",8),p(14,"Your Password"),l(),a(15,"input",9,1),g("change",function(){return d(n),c(e.resetError())})("input",function(){return d(n),c(e.resetError())}),l()(),a(17,"div",4)(18,"button",10),g("click",function(o){return d(n),c(e.submitHandler(o))}),p(19),l(),a(20,"button",11),g("click",function(){return d(n),c(e.switchAuthModeHandler())}),p(21),l()()(),w(22,ne,2,0,"ng-container"),l()()()}r&2&&(u("ngClass","auth"),s(3),u("ngClass","header"),s(),V(e.isLogin()?"Login":"Sign Up"),s(2),b(e.isLogin()?-1:6),s(),u("ngClass","control"),s(5),u("ngClass","control"),s(5),u("ngClass","actions"),s(),u("ngClass","contained medium")("disabled",e.isSubmitting()),s(),E(" ",e.isLogin()?"Login":"Create Account"," "),s(),u("ngClass","basic large"),s(),E(" ",e.isLogin()?"Create new account":"Login with existing account"," "),s(),b(e.error().error_state?22:-1))},dependencies:[O,N,Y,H,G,Q,x,W,j,z,B,k,U],styles:[".auth[_ngcontent-%COMP%]{margin:3rem auto;width:95%;max-width:25rem;border-radius:6px;padding:1rem;text-align:center}.auth[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center}.control[_ngcontent-%COMP%]{margin-bottom:.5rem}.control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:700;margin-bottom:.5rem}.actions[_ngcontent-%COMP%]{margin-top:1.5rem;display:flex;flex-direction:column;align-items:center;gap:20px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}.header[_ngcontent-%COMP%]{margin:0;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;font-size:1.5rem;line-height:1.334;letter-spacing:0em;display:block;padding:16px}"]})}}return m})();var Ie=[{path:"",component:J}];export{Ie as loginRoutes};
