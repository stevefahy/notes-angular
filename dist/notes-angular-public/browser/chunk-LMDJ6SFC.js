import{b as fe}from"./chunk-FSZM5M3Y.js";import{a as Me,b as q,c as De,d as Ee,e as Te,f as Le,g as Oe,h as Pe,i as $e}from"./chunk-22FE2GLT.js";import"./chunk-I2GAQSL5.js";import{a as _e,b as ge,c as Ne,d as Ce,e as ke,f as we}from"./chunk-S3FOCIPD.js";import{a as Fe,b as Ye,c as Ze,d as Re}from"./chunk-5BL4AN2G.js";import{a as R}from"./chunk-MDPPAVRL.js";import{a as Ae,b as Ie,c as Ve}from"./chunk-E3JQL47Z.js";import{b as G}from"./chunk-EPS5JTFB.js";import{a as ve,b as ye,d as xe}from"./chunk-TB2NPGND.js";import{a as Se}from"./chunk-NQ5HE5ZT.js";import{D as he,i as le,k as ce,l as me,oa as U,q as ue,qa as Q,r as D,ra as w,sa as _,ta as v,ua as pe,wa as be}from"./chunk-KMYELJ2F.js";import{Cb as j,Db as b,Eb as f,Fb as B,Gb as z,Hb as k,Ib as s,Jb as a,Jc as L,Kb as T,Ob as oe,Oc as O,Pb as M,Rb as g,Tb as u,U as N,Xb as ne,Yb as ie,Zb as re,_a as m,a as A,b as $,cc as p,da as S,ea as Z,ec as J,f as Y,fc as se,g as h,gc as ae,hc as de,ja as ee,jb as te,k as V,ka as y,la as x,nb as E,r as H,wa as c}from"./chunk-XGJ3VW6B.js";var et=w,He=(n,d)=>h(null,null,function*(){let e;try{if(e=yield fetch(v.APP_API_ENDPOINT+`api/data/notes/${d}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}}),e.status===404)throw new Error(`${e.url} Not Found.`)}catch(o){return{error:_(o)}}let t;try{if(t=yield e.json(),t===null)return{error:`${et.NOTES_ERROR}`}}catch(o){return{error:_(o)}}return t.error?{error:t.error}:t});var tt=w,je=(n,d)=>h(null,null,function*(){let e,t={note_ids:d};try{if(e=yield fetch(v.APP_API_ENDPOINT+"api/data/delete-notes",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)}),e.status===404)throw new Error(`${e.url} Not Found.`)}catch(i){return{error:_(i)}}let o;try{if(o=yield e.json(),o===null)return{error:`${tt.NOTES_DELETE_ERROR}`}}catch(i){return{error:_(i)}}return o.error?{error:o.error}:o});var ot=w,Be=(n,d,e)=>h(null,null,function*(){let t,o={notebookID:d,notebookUpdated:e};try{if(t=yield fetch(v.APP_API_ENDPOINT+"api/data/edit-notebook-date",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(o)}),t.status===404)throw new Error(`${t.url} Not Found.`)}catch(r){return{error:_(r)}}let i;try{if(i=yield t.json(),i===null)return{error:`${ot.NOTEBOOK_UPDATE_DATE_ERROR}`}}catch(r){return{error:_(r)}}return i.error?{error:i.error}:i});var nt=w,ze=(n,d)=>h(null,null,function*(){let e;try{let o={notebookID:d};if(e=yield fetch(v.APP_API_ENDPOINT+"api/data/delete-notebook",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(o)}),e.status===404)throw new Error(`${e.url} Not Found.`)}catch(o){return{error:_(o)}}let t;try{if(t=yield e.json(),t===null)return{error:`${nt.NOTEBOOK_DELETE_ERROR}`}}catch(o){return{error:_(o)}}return t.error?{error:t.error}:t});var it=w,Je=(n,d,e,t,o)=>h(null,null,function*(){let i,r={notebookID:d,notebookName:e,notebookCover:t,notebookUpdated:o};try{if(i=yield fetch(v.APP_API_ENDPOINT+"api/data/edit-notebook",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(r)}),i.status===404)throw new Error(`${i.url} Not Found.`)}catch(C){return{error:_(C)}}let l;try{if(l=yield i.json(),l===null)return{error:`${it.NOTES_ERROR}`}}catch(C){return{error:_(C)}}return l.error?{error:l.error}:l});var rt=w,Ue=(n,d,e,t)=>h(null,null,function*(){let o,i={notes:e,notebookID:d,latestUpdatedNote:t};try{if(o=yield fetch(v.APP_API_ENDPOINT+"api/data/move-notes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(i)}),o.status===404)throw new Error(`${o.url} Not Found.`)}catch(l){return{error:_(l)}}let r;try{if(r=yield o.json(),r===null)return{error:`${rt.NOTES_ERROR}`}}catch(l){return{error:_(l)}}return r.error?{error:r.error}:r});var at=["errorcontainer"];function dt(n,d){if(n&1&&(s(0,"option",17),p(1),a()),n&2){let e=u().$implicit;k("value",e._id),m(),J(" ",e.notebook_name," ")}}function lt(n,d){if(n&1&&b(0,dt,2,2,"option",17),n&2){let e=d.$implicit,t=u(2);f(e._id!==t.notebookId?0:-1)}}function ct(n,d){if(n&1&&B(0,lt,1,1,null,null,j().trackByNotebooks,!0),n&2){let e=u();z(e.notebooksSorted())}}function mt(n,d){n&1&&oe(0,null,0)}var Qe=(()=>{class n{constructor(){this.selectedNotebook=c(""),this.formIsValid=c(!1),this.notebooksSorted=c(null),this.error=c({error_state:!1,error_severity:"",message:""}),this.error$=D(this.error),this.data=S(De),this.onDestroy$=new V,this.trackByNotebooks=(e,t)=>t?t._id:void 0,this.findNotebook=e=>{let t=this.notebooks.findIndex(o=>o._id===e);return this.notebooks[t]},this.sortNotes=e=>(e.forEach(t=>{t.updatedAt==="No date"&&(t.updatedAt="December 17, 1995 03:24:00"),t.createdAt==="No date"&&(t.createdAt="December 17, 1995 03:24:00")}),e.sort((t,o)=>t.updatedAt!==void 0&&o.updatedAt!==void 0?new Date(t.updatedAt)>new Date(o.updatedAt)?1:-1:t.updatedAt!==void 0?1:-1).reverse(),e),this.cancelHandler=e=>{e.preventDefault(),e.stopPropagation(),this.error().error_state&&this.resetError(),this.onCancel()},this.submitHandler=e=>h(this,null,function*(){if(e.preventDefault(),e.stopPropagation(),this.error().error_state&&this.resetError(),this.findNotebook(this.selectedNotebook()),!this.selectedNotebook()){this.formIsValid.set(!1);return}this.moveNotes(this.selectedNotebook()),this.onCancel()}),this.resetError=()=>{this.componentRef&&this.componentRef.destroy(),this.formIsValid.set(!0),this.error.update(e=>$(A({},e),{error_state:!1,error_severity:"",message:""}))},this.handleChange=e=>{this.selectedNotebook.update(t=>e.target.value),e.target.value==="default"?this.formIsValid.set(!1):this.formIsValid.set(!0)}}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.onCancel=this.data.onCancel,this.moveNotes=this.data.moveNotes,this.notebooks=this.data.notebooks,this.notebookId=this.data.notebookId,this.notebooks$=H(this.notebooks),this.notebooks$.pipe(N(this.onDestroy$)).subscribe(e=>{if(e){let t=this.sortNotes(e);this.notebooksSorted.set(t)}}),this.error$.pipe(N(this.onDestroy$)).subscribe(e=>{e.error_state&&this.addErrorComponent()})}addErrorComponent(){import("./chunk-GASE2SWZ.js").then(e=>{let t=e.LazyLoadedModule.components.dynamicComponent;this.componentRef=this.errorcontainer.createComponent(t),this.componentRef.instance.error_state=this.error().error_state,this.componentRef.instance.error_severity=this.error().error_severity,this.componentRef.instance.message=this.error().message})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["SelectNotebookForm"]],viewQuery:function(t,o){if(t&1&&ne(at,5,te),t&2){let i;ie(i=re())&&(o.errorcontainer=i.first)}},inputs:{notebooks:"notebooks",onCancel:"onCancel",moveNotes:"moveNotes"},decls:25,vars:3,consts:[["errorcontainer",""],["ngClass","dialogue_container"],["mat-dialog-title","","ngClass","dialogue-title"],["mat-dialog-content",""],["ngClass","form"],["ngClass","control"],["htmlFor","new-notebook-cover"],["name","notebooks","id","notebooks","value","selectedNotebook",3,"change"],["defaultValue","true","value","default"],["ngClass","button_row"],["ngClass","action"],["ngClass","move"],["mat-button","","color","secondary","aria-label","Move Note button","ngClass","contained medium",3,"click","disabled"],["ngClass","icon_text"],["ngClass","cancel"],["mat-button","","color","secondary","aria-label","Edit notebook button","ngClass","contained medium",3,"click"],["ngClass","material-symbols-outlined button_icon white"],[3,"value"]],template:function(t,o){t&1&&(s(0,"div",1)(1,"h2",2),p(2,"Move to Notebook"),a(),s(3,"div",3)(4,"form",4)(5,"div",5)(6,"label",6),p(7,"Name"),a(),s(8,"select",7),g("change",function(r){return o.handleChange(r)}),s(9,"option",8),p(10," Select a notebook... "),a(),b(11,ct,2,0),a()()(),s(12,"div",9)(13,"div",10)(14,"div",11)(15,"button",12),g("click",function(r){return o.submitHandler(r)}),s(16,"span",13),p(17," Move Note "),a()()(),s(18,"div",14)(19,"button",15),g("click",function(r){return o.cancelHandler(r)}),s(20,"span",13)(21,"span",16),p(22," cancel "),a(),p(23," Cancel "),a()()()()(),b(24,mt,2,0,"ng-container"),a()()),t&2&&(m(11),f(o.notebooks&&o.notebooksSorted()?11:-1),m(4),k("disabled",!o.formIsValid()),m(9),f(o.error().error_state?24:-1))},dependencies:[O,L,we,Ne,Ce,ke,_e,ge,Oe,Te,Le,Q,U,G],styles:[".button_row[_ngcontent-%COMP%]{width:100%}.form[_ngcontent-%COMP%]{width:100%;margin:1rem auto}.control[_ngcontent-%COMP%]{display:flex;margin-bottom:.5rem;flex-direction:row;align-items:flex-start;justify-content:space-between;gap:5px}.control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:.5rem;color:#353336;display:block}.control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:block;font:inherit;max-width:100%;width:200px;border-radius:4px;border:1px solid #38015c;padding:.25rem;background-color:#f7f0fa}.action[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.dialogue_container[_ngcontent-%COMP%]{max-width:300px}@media only screen and (max-width:380px){.control[_ngcontent-%COMP%]{gap:5px}.control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-size:.7rem!important;padding-top:unset;padding-bottom:unset}}"]})}}return n})();var Ge=Y(Ye()),Ke=Y(Ze());function ut(n,d){n&1&&T(0,"ngx-skeleton-loader",0)}function ht(n,d){if(n&1&&T(0,"ViewNoteMarkdown",3),n&2){let e=u(2);k("viewText",e.content)("updatedViewText",e.updateViewText)("disableLinks",!0)}}function pt(n,d){if(n&1&&(s(0,"div",1)(1,"article",2),b(2,ht,1,3,"ViewNoteMarkdown",3),a()()),n&2){let e=u();m(2),f(e.isLoaded()?2:-1)}}window.global=window;global.Buffer=global.Buffer||Ke.Buffer;window.process={version:""};var qe=(()=>{class n{constructor(){this.isLoaded=c(!1),this.hideSkeleton=()=>{this.loadedTimer=setTimeout(()=>{this.isLoaded.set(!0),clearTimeout(this.loadedTimer)},600)}}set text(e){this.content=(0,Ge.default)(e).content,this.hideSkeleton()}ngOnInit(){}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["ViewNoteThumb"]],inputs:{text:"text",updatedViewText:"updatedViewText"},decls:2,vars:2,consts:[["count","1","appearance","line"],["ngClass","box"],["ngClass","viewnote_content viewnote_thumb"],[3,"viewText","updatedViewText","disableLinks"]],template:function(t,o){t&1&&(b(0,ut,1,0,"ngx-skeleton-loader",0),b(1,pt,3,1,"div",1)),t&2&&(f(o.isLoaded()?-1:0),m(),f(o.isLoaded()?1:-1))},dependencies:[O,L,Ve,Ie,Re],styles:[".edit[_ngcontent-%COMP%]{background-color:#f0f8ff;outline:0px solid transparent}.box[_ngcontent-%COMP%]{display:flex;flex-flow:column;max-height:200px;overflow:hidden}.box[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{border:1px dotted grey}.box[_ngcontent-%COMP%]   .row.header[_ngcontent-%COMP%]{flex:0 1 auto}.box[_ngcontent-%COMP%]   .row.content[_ngcontent-%COMP%]{flex:1 1 auto}.box[_ngcontent-%COMP%]   .row.footer[_ngcontent-%COMP%]{flex:0 1 40px}"],changeDetection:0})}}return n})();function bt(n,d){if(n&1){let e=M();s(0,"div",11)(1,"div",12)(2,"input",13),g("change",function(o){y(e);let i=u(3);return x(i.checkboxStatus(o))}),a()()()}if(n&2){let e=u().$implicit;m(2),k("id",ae("`input_",e._id,"`"))("value",se(e._id))}}function ft(n,d){if(n&1){let e=M();s(0,"li",1)(1,"div",2)(2,"a",3),g("click",function(){y(e);let o=u(2);return x(o.NoteLinkHandler)}),s(3,"div",4)(4,"div",5),g("click",function(){let o=y(e).$implicit,i=u(2);return x(i.EditLinkHandler(o._id))}),s(5,"mat-card",6)(6,"mat-card-content",7)(7,"div",8),T(8,"ViewNoteThumb",9),a(),s(9,"div",10),p(10),a()()()()()(),b(11,bt,3,4,"div",11),a()()}if(n&2){let e=d.$implicit,t=u(2);m(2),k("routerLink",de("/notebook/",e.notebook,"/",e._id)),m(2),k("id",e._id),m(4),k("text",e.note),m(2),J(" ",t.dateFormat(e.updatedAt)," "),m(),f(t.onNotesEdit?11:-1)}}function _t(n,d){if(n&1&&(s(0,"ul",0),B(1,ft,12,7,"li",1,j().trackuserNotes,!0),a()),n&2){let e=u();m(),z(e.userNotes())}}var We=(()=>{class n{constructor(){this.dateFormat=$e,this.userNotes=c([]),this.isChecked=c([]),this.isSelected=c({selected:[]}),this.injector=S(Z),this.onDestroy$=new V,this.trackuserNotes=(e,t)=>t?t._id:void 0,this.updateCheckbox=(e,t)=>{this.isChecked.update(o=>{let i=[...o],r=this.isChecked()?.findIndex(l=>l.id===e);return r>=0&&i.length>0&&(i[r].selected=t),i}),this.isSelected.update(o=>{let i={selected:[]};return this.isChecked()?.forEach(r=>{r.selected&&i.selected.push(r.id)}),$(A({},o),{selected:i.selected})})},this.checkboxStatus=e=>{let t=e.currentTarget,{checked:o}=t,i=t.value;this.updateCheckbox(i,o)},this.divStatus=e=>{let t=document.getElementById(`input_${e}`),{checked:o}=t,i=t.value;t.checked=!o,o=t.checked,this.updateCheckbox(i,o)},this.NoteLinkHandler=e=>{this.onNotesEdit&&e.preventDefault()},this.EditLinkHandler=e=>{this.onNotesEdit&&this.divStatus(e)}}set notes(e){this.userNotes.set(e);let t=e;if(t){this.userNotes.update(i=>t);let o=[];t.forEach(i=>{this.isChecked.update(r=>{let l={id:i._id,selected:!1};return o.push(l),o})})}}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){ee(this.injector,()=>{this.isSelected$=D(this.isSelected),this.isSelected$.pipe(N(this.onDestroy$)).subscribe(e=>{e&&this.onNotesSelected(e)})}),this.onClearNotesEdit$=H(this.onClearNotesEdit),this.onClearNotesEdit$.pipe(N(this.onDestroy$)).subscribe(e=>{e&&this.isSelected.update(t=>$(A({},t),{selected:[]}))})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["NoteList"]],inputs:{notes:"notes",onNotesSelected:"onNotesSelected",onNotesEdit:"onNotesEdit",onClearNotesEdit:"onClearNotesEdit"},decls:1,vars:1,consts:[["ngClass","notes_list"],["key","{note._id}","ngClass","notebook_list_bg"],["ngClass","thumb_outer"],["ngClass","thumb_outer_link",3,"click","routerLink"],["ngClass","thumb_outer_link"],["ngClass","edit_link",3,"click","id"],["ngClass","note_list_card"],["ngClass","cardcontent"],["ngClass","thumb_image"],[3,"text"],["ngClass","date_format date_format_notes"],["ngClass","thumb_select_outer"],["ngClass","thumb_select"],["type","checkbox","name","Status",3,"change","id","value"]],template:function(t,o){t&1&&b(0,_t,3,0,"ul",0),t&2&&f(o.userNotes()?0:-1)},dependencies:[O,L,ue,me,xe,ve,ye,qe],styles:[".notes_list[_ngcontent-%COMP%]{list-style:none;margin-block-start:0em;padding-inline-start:0px;padding-left:10px;padding-right:10px}.notes_list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding-top:10px}.notebook_list_bg[_ngcontent-%COMP%]{position:relative}.thumb_select[_ngcontent-%COMP%]{position:absolute;right:10px;top:15px;z-index:1000}.thumb_select_outer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%}.note_list_card[_ngcontent-%COMP%]:hover{background-color:#f7f7f7}.thumb_image[_ngcontent-%COMP%]{min-height:calc(var(--viewnotethumb-box-min-height) * 1px);min-height:45px;max-height:300px;overflow-y:hidden;width:100%;padding:0;margin:0}.thumb_outer_link[_ngcontent-%COMP%]{cursor:pointer;width:100%}.thumb_outer[_ngcontent-%COMP%]{display:flex;width:100%;flex-direction:row;align-items:flex-start;min-height:81px}.thumb_outer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .thumb_outer[_ngcontent-%COMP%]   .edit_link[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})}}return n})();function gt(n,d){n&1&&T(0,"LoadingScreen")}function Nt(n,d){if(n&1&&T(0,"NoteList",5),n&2){let e=u(2);k("notes",e.notes())("onNotesSelected",e.updateSelected)("onNotesEdit",e.editNotes())("onClearNotesEdit",e.clearEditNotes())}}function Ct(n,d){if(n&1&&b(0,Nt,1,4,"NoteList",5),n&2){let e=u();f(e.notesLoaded()&&e.notebook()&&e.notes()!==null?0:-1)}}function kt(n,d){if(n&1){let e=M();s(0,"button",6),g("click",function(){y(e);let o=u();return x(o.addNoteFormHandler())}),s(1,"span",7)(2,"span",8),p(3," note_add "),a(),p(4," Add Note "),a()()}}function wt(n,d){if(n&1){let e=M();s(0,"button",9),g("click",function(){y(e);let o=u();return x(o.editNoteFormHandler())}),s(1,"span",7)(2,"span",8),p(3," edit "),a(),p(4," Edit Notes "),a()()}}function vt(n,d){if(n&1){let e=M();s(0,"button",10),g("click",function(){y(e);let o=u();return x(o.deleteNotebookHandler())}),s(1,"span",7)(2,"span",8),p(3," delete "),a(),p(4," Delete Notebook "),a()()}}function yt(n,d){if(n&1){let e=M();s(0,"button",13),g("click",function(){y(e);let o=u(2);return x(o.moveNoteFormHandler())}),s(1,"span",7)(2,"span",8),p(3," flip_to_front "),a(),p(4," Move "),a()()}}function xt(n,d){if(n&1){let e=M();s(0,"button",11),g("click",function(){y(e);let o=u();return x(o.deleteNoteHandler())}),s(1,"span",7)(2,"span",8),p(3," delete "),a(),p(4," Delete "),a()(),b(5,yt,5,0,"button",12)}if(n&2){let e=u();m(5),f(e.userNotebooks()&&e.userNotebooks().length>1?5:-1)}}function St(n,d){if(n&1){let e=M();s(0,"button",14),g("click",function(){y(e);let o=u();return x(o.cancelEditNoteFormHandler())}),s(1,"span",7)(2,"span",8),p(3," cancel "),a(),p(4," Cancel "),a()()}}var Xe=(()=>{class n{constructor(){this.activatedRoute=S(le),this.authService=S(be),this.store=S(he),this.router=S(ce),this.dialog=S(Ee),this.notes=c(null),this.notesLoadedDelay=c(!1),this.notesLoadedDelay$=D(this.notesLoadedDelay),this.notesLoaded=c(!1),this.notesLoaded$=D(this.notesLoaded),this.notebookLoaded=c(!1),this.notebookLoaded$=D(this.notebookLoaded),this.notebooksLoaded=c(!1),this.notebooksLoaded$=D(this.notebooksLoaded),this.notebook=c(null),this.userNotebooks=c(null),this.isSelected=c(null),this.moveNote=c(!1),this.enableEditNotebook=c(!1),this.editNotes=c(!1),this.clearEditNotes=c(!1),this.onDestroy$=new V,this.updateContext=e=>{this.loading=e.loading,this.token=e.token},this.showNotification=e=>{this.store.dispatch(pe.showNotification({notification:{n_status:"error",title:"Error!",message:e}}))},this.sortNotes=e=>(e.forEach(t=>{t.updatedAt==="No date"&&(t.updatedAt="December 17, 1995 03:24:00")}),e.sort((t,o)=>t.updatedAt!==void 0&&o.updatedAt!==void 0?new Date(t.updatedAt)>new Date(o.updatedAt)?1:-1:t.updatedAt!==void 0?1:-1).reverse(),e),this.loadNotes=()=>h(this,null,function*(){if(!this.notesLoaded()&&this.token&&this.notebookId){this.notesLoadedDelay.set(!1),this.notesLoaded.set(!1);try{let e=yield He(this.token,this.notebookId);if(this.notebookLoaded.set(!0),e.error){this.showNotification(`${e.error}`);return}if(e.success){let t=this.sortNotes(e.notes);this.notes.set(t),this.notesLoadedDelay.set(!0)}}catch(e){this.showNotification(`${e}`),this.notesLoadedDelay.set(!0);return}}}),this.loadNotebook=()=>h(this,null,function*(){if(!this.notebookLoaded()&&this.token&&this.notebookId){this.notebookLoaded.set(!1);try{let e=yield Fe(this.token,this.notebookId);if(this.notebookLoaded.set(!0),e.error){this.showNotification(`${e.error}`);return}e.success&&(this.notebook.set(e.notebook),this.store.dispatch(R.edited(e.notebook)))}catch(e){this.showNotification(`${e}`),this.notebookLoaded.set(!0);return}}}),this.loadNotebooks=()=>h(this,null,function*(){if(!this.notebooksLoaded()&&this.token){this.notebooksLoaded.set(!1);try{let e=yield Me(this.token);if(this.notebooksLoaded.set(!0),e.error){this.showNotification(`${e.error}`);return}e.success&&this.userNotebooks.set(e.notebooks)}catch(e){this.showNotification(`${e}`),this.notebooksLoaded.set(!0);return}}}),this.updateSelected=e=>{this.isSelected.update(t=>e)},this.moveNoteFormHandler=()=>{this.moveNote.update(e=>!0),this.openSelectNotebookDialog()},this.cancelHandler=()=>{this.moveNote.update(e=>!1),this.dialogRefSelectNotebook.close()},this.cancelEditHandler=()=>{this.enableEditNotebook.update(e=>!1),this.store.dispatch(R.editing({status:!1})),this.dialogRefEditNotebook.close()},this.editNotebookBtnHandler=()=>{this.enableEditNotebook.update(e=>!0),this.openAddNotebookFormDialog()},this.addNoteFormHandler=()=>{this.router.navigate([`/notebook/${this.notebookId}/create-note`])},this.editNoteFormHandler=()=>{this.editNotes.set(!0),this.clearEditNotes.set(!1)},this.resetNotesSelected=()=>{this.isSelected.update(e=>{let t={selected:[]};return $(A({},e),{selected:t.selected})})},this.cancelEditNoteFormHandler=()=>{this.editNotes.set(!1),this.clearEditNotes.set(!0),this.resetNotesSelected()},this.updateNotebookDate=(e,t)=>{this.editNotebookDateHandler(e,t)},this.deleteNoteHandler=()=>h(this,null,function*(){let e;if(this.token&&this.isSelected()!==null&&this.isSelected()!==void 0&&this.isSelected()?.selected!==null){e=this.isSelected().selected;try{let t=yield je(this.token,e);if(this.notebookLoaded.set(!0),t.error){this.showNotification(`${t.error}`);return}if(t.success){let o,i=this.notes()[0].updatedAt;if(this.notes.update(r=>{let l,C=[];if(r){l=[...r];let F=l.length;for(;F--;){var P=l[F];e.indexOf(P._id)===-1&&C.push(P)}let I=C.reverse();return I.length>0&&(o=I[0].updatedAt),I}else return null}),o!==void 0&&this.notebookId!==void 0&&i&&new Date(o).getTime()!==new Date(i).getTime()){let r=String(this.notebookId);this.updateNotebookDate(r,o)}this.cancelEditNoteFormHandler()}}catch(t){this.showNotification(`${t}`);return}}}),this.editNotebookDateHandler=(e,t)=>h(this,null,function*(){if(this.token&&e&&t)try{let o=yield Be(this.token,e,t);if(o.error){this.showNotification(`${o.error}`);return}o.success}catch(o){this.showNotification(`${o}`);return}}),this.deleteNotebookHandler=()=>h(this,null,function*(){let e=this.notebook()._id;if(this.token&&e&&e.length>0)try{let t=yield ze(this.token,e);if(t.error){this.showNotification(`${t.error}`);return}t.success&&this.router.navigate(["/notebooks"])}catch(t){this.showNotification(`${t}`);return}}),this.editNotebookHandler=(e,t,o,i)=>h(this,null,function*(){if(this.token&&e&&t&&o&&i)try{let r=yield Je(this.token,e,t,o,i);if(r.error){this.showNotification(`${r.error}`);return}r.success&&(this.notebook.update(l=>r.notebook_edited),this.store.dispatch(R.editing({status:!1})),this.store.dispatch(R.edited(r.notebook_edited)),this.enableEditNotebook.update(l=>!1))}catch(r){this.showNotification(`${r}`);return}}),this.getLatestUpdated=e=>{let t=[];for(let r in e)if(this.notes()!==null){var o=this.notes().filter(l=>l._id===e[r]);t.push(o[0])}return this.sortNotes(t)[0].updatedAt},this.moveNoteHandler=e=>h(this,null,function*(){let t;if(this.token&&e&&this.isSelected()!==null&&this.isSelected()!==void 0&&this.isSelected()?.selected!==null){t=this.isSelected().selected;let o=this.getLatestUpdated(t);try{let i=yield Ue(this.token,e,t,o);if(i.error){this.showNotification(`${i.error}`);return}if(i.success){let r;if(this.notes.update(l=>{let C,P=[];if(l){C=[...l];let I=C.length;for(;I--;){var F=C[I];t.indexOf(F._id)===-1&&P.push(F)}let K=P.reverse();return K.length>0&&(r=K[0].updatedAt),K}else return null}),r!==void 0&&this.notebookId!==void 0){let l=String(this.notebookId);this.updateNotebookDate(l,r)}this.moveNote.update(l=>!1),this.cancelEditNoteFormHandler()}}catch(i){this.showNotification(`${i}`);return}}})}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.activatedRoute.params.pipe(N(this.onDestroy$)).subscribe(e=>{this.notebookId=e.notebookId}),this.authService.authContext$.pipe(N(this.onDestroy$)).subscribe(e=>{this.updateContext(e)}),this.store.select(fe).pipe(N(this.onDestroy$)).subscribe(e=>{e.status===!0&&this.editNotebookBtnHandler()}),this.notesLoadedDelay$.pipe(N(this.onDestroy$)).subscribe(e=>{e&&(this.loadingTimer=setTimeout(()=>{this.notesLoaded.set(!0),clearTimeout(this.loadingTimer)},100))}),this.notesLoaded$.pipe(N(this.onDestroy$)).subscribe(e=>{e||this.loadNotes()}),this.notebookLoaded$.pipe(N(this.onDestroy$)).subscribe(e=>{e||this.loadNotebook()}),this.notebooksLoaded$.pipe(N(this.onDestroy$)).subscribe(e=>{e||this.loadNotebooks()})}openSelectNotebookDialog(){let e=new q;e.disableClose=!0,e.autoFocus=!0,e.data={notebooks:this.userNotebooks(),onCancel:this.cancelHandler,moveNotes:this.moveNoteHandler,notebookId:this.notebookId},this.dialogRefSelectNotebook=this.dialog.open(Qe,e)}openAddNotebookFormDialog(){let e=new q;e.disableClose=!0,e.autoFocus=!0,e.data={notebook:this.notebook(),method:"edit",editNotebook:this.editNotebookHandler,onCancel:this.cancelEditHandler},this.dialogRefEditNotebook=this.dialog.open(Pe,e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["Notebook"]],decls:9,vars:7,consts:[["ngClass","page_scrollable_header_breadcrumb_footer_list"],["mat-button","","color","secondary","aria-label","Add note button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Edit Notes button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Delete Notebook button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Cancel Note button","ngClass","contained medium breadcrumb_edit_fab button_fab"],[3,"notes","onNotesSelected","onNotesEdit","onClearNotesEdit"],["mat-button","","color","secondary","aria-label","Add note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["ngClass","icon_text"],["ngClass","material-symbols-outlined button_icon white"],["mat-button","","color","secondary","aria-label","Edit Notes button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Delete Notebook button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Delete Note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Move Note button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Move Note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Cancel Note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"]],template:function(t,o){t&1&&(b(0,gt,1,0,"LoadingScreen"),s(1,"div",0),b(2,Ct,1,1),a(),s(3,"Footer"),b(4,kt,5,0,"button",1),b(5,wt,5,0,"button",2),b(6,vt,5,0,"button",3),b(7,xt,6,1),b(8,St,5,0,"button",4),a()),t&2&&(f(!o.notebookLoaded()||!o.notesLoaded()?0:-1),m(2),f(o.notebookLoaded()&&o.notesLoaded()&&o.notebook()&&o.notes()?2:-1),m(2),f(o.notebookLoaded()&&o.notesLoaded()&&!o.editNotes()?4:-1),m(),f(o.notebookLoaded()&&o.notesLoaded()&&!o.editNotes()&&o.notes()&&o.notes().length>0?5:-1),m(),f(o.notebookLoaded()&&o.notesLoaded()&&o.notes()&&o.notes().length<1?6:-1),m(),f(o.notebookLoaded()&&o.notesLoaded()&&o.editNotes()&&o.isSelected()&&o.isSelected().selected.length>0?7:-1),m(),f(o.notebookLoaded()&&o.notesLoaded()&&o.editNotes()?8:-1))},dependencies:[O,L,Q,U,G,Se,Ae,We],encapsulation:2,changeDetection:0})}}return n})();var kn=[{path:"",component:Xe}];export{kn as notebookRoutes};
