import{C as G,D as Q,E as H,F as Y,H as z,T as B,U as W,V as J,_ as K,aa as X,l as $,n as R,q as j,s as q}from"./chunk-4KA7YYCZ.js";import{$b as F,Ba as y,Lb as I,Mb as E,Pb as u,Qb as a,Rb as l,Wb as x,Xb as P,Y as A,Zb as f,Zc as U,cd as k,db as o,dc as O,ea as w,ec as _,fc as C,j as S,mb as L,n as N,nc as g,ob as D,oc as T,pa as d,pc as M,qa as p,sb as V,tb as b}from"./chunk-AS4DOYW2.js";var ie=["usernameInputRef"],ne=["emailInputRef"],oe=["passwordInputRef"],se=["errorcontainer"];function ae(r,re){if(r&1){let n=P();a(0,"div")(1,"div",4)(2,"label",12),g(3,"Your Name"),l(),a(4,"input",13,2),f("input",function(){d(n);let e=F();return p(e.resetError())}),l()()()}r&2&&(o(),u("ngClass","control"))}function le(r,re){r&1&&x(0,null,3)}var h=j,ee=(()=>{class r{constructor(n,i){this.authService=n,this.router=i,this.isLogin=y(!0),this.isSubmitting=y(!1),this.error=y({error_state:!1,error_severity:"",message:""}),this.error$=q(this.error),this.onDestroy$=new N,this.componentAdded=!1,this.updateContext=e=>{this.onLogin=e.onLogin,this.onRegister=e.onRegister},this.switchAuthModeHandler=()=>{this.isLogin.update(e=>!e),this.resetError()},this.resetError=()=>{this.error.set({error_state:!1,message:""}),this.isSubmitting.set(!1)},this.validateForm=e=>{if(e.includes("username")&&this.usernameInputRef.nativeElement.value.length<2)return this.usernameInputRef.nativeElement.focus(),this.error.set({error_state:!0,message:h.SIGNUP_INVALID_USERNAME}),!1;if(e.includes("email")){let t=this.emailInputRef.nativeElement.value;if(!t||!t.includes("@")||!t.includes("."))return this.emailInputRef.nativeElement.focus(),this.error.set({error_state:!0,message:h.SIGNUP_INVALID_EMAIL}),!1}if(e.includes("password")){let t=this.passwordInputRef.nativeElement.value;if(!t||t.trim().length<7)return this.passwordInputRef.nativeElement.focus(),this.error.set({error_state:!0,message:h.SIGNUP_INVALID_PASSWORD}),!1}return!0},this.submitHandler=e=>S(this,null,function*(){e.preventDefault(),this.error.set({error_state:!1,message:""}),this.isSubmitting.set(!0);let t=this.emailInputRef.nativeElement.value,c=this.passwordInputRef.nativeElement.value;if(this.isLogin()){if(!this.validateForm(["email","password"]))return;try{let m=yield this.onLogin(t,c);if(m&&m===void 0||m&&m.error){m.error||(m.error="Unauthorised"),this.error.set({error_state:!0,message:m.error});return}else this.router.navigate([`${h.DEFAULT_PAGE}`])}catch(m){this.error.set({error_state:!0,message:m.message})}}else{let v=this.usernameInputRef.nativeElement.value;if(!this.validateForm(["username","email","password"]))return;try{let s=yield this.onRegister(v,t,c,"angular");if(this.isSubmitting.set(!1),s==null){this.router.navigate([`${h.DEFAULT_PAGE}`]);return}if(s.error){this.error.set({error_state:!0,message:s.error});return}s.success&&s.notebookID&&s.noteID?this.router.navigate([`/notebook/${s.notebookID}/${s.noteID}`]):this.router.navigate([`${h.DEFAULT_PAGE}`])}catch(s){this.error.set({error_state:!0,message:s.message})}}})}ngOnDestroy(){this.sub.unsubscribe(),this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.sub=this.authService.authContext$.subscribe({next:n=>{this.updateContext(n)}}),this.error$.pipe(A(this.onDestroy$)).subscribe(n=>{n.error_state&&this.addErrorComponent()})}addErrorComponent(){this.isSubmitting.set(!0),import("./chunk-IFURLEYA.js").then(n=>{let i=n.LazyLoadedModule.components.dynamicComponent,e=this.errorcontainer.createComponent(i);e.instance.error_state=this.error().error_state,e.instance.error_severity=this.error().error_severity,e.instance.message=this.error().message})}static{this.\u0275fac=function(i){return new(i||r)(L(G),L($))}}static{this.\u0275cmp=V({type:r,selectors:[["LoginPage"]],viewQuery:function(i,e){if(i&1&&O(ie,5)(ne,5)(oe,5)(se,5,D),i&2){let t;_(t=C())&&(e.usernameInputRef=t.first),_(t=C())&&(e.emailInputRef=t.first),_(t=C())&&(e.passwordInputRef=t.first),_(t=C())&&(e.errorcontainer=t.first)}},standalone:!1,decls:23,vars:13,consts:[["emailInputRef",""],["passwordInputRef",""],["usernameInputRef",""],["errorcontainer",""],[3,"ngClass"],["novalidate",""],["htmlFor","email"],["type","email","id","email","required","","placeholder","Email","autoComplete","email",3,"change","input"],["htmlFor","password"],["type","password","id","password","required","","placeholder","Password","autoComplete","current-password",3,"change","input"],["mat-button","","color","secondary",3,"click","ngClass","disabled"],["mat-button","",3,"click","ngClass"],["htmlFor","username"],["type","text","id","username","required","","placeholder","Username","autoComplete","username",3,"input"]],template:function(i,e){if(i&1){let t=P();a(0,"section",4)(1,"mat-card")(2,"mat-card-content")(3,"mat-card-header",4),g(4),l(),a(5,"form",5),I(6,ae,6,1,"div"),a(7,"div",4)(8,"label",6),g(9,"Your Email"),l(),a(10,"input",7,0),f("change",function(){return d(t),p(e.resetError())})("input",function(){return d(t),p(e.resetError())}),l()(),a(12,"div",4)(13,"label",8),g(14,"Your Password"),l(),a(15,"input",9,1),f("change",function(){return d(t),p(e.resetError())})("input",function(){return d(t),p(e.resetError())}),l()(),a(17,"div",4)(18,"button",10),f("click",function(v){return d(t),p(e.submitHandler(v))}),g(19),l(),a(20,"button",11),f("click",function(){return d(t),p(e.switchAuthModeHandler())}),g(21),l()()(),I(22,le,2,0,"ng-container"),l()()()}i&2&&(u("ngClass","auth"),o(3),u("ngClass","header"),o(),T(e.isLogin()?"Login":"Sign Up"),o(2),E(e.isLogin()?-1:6),o(),u("ngClass","control"),o(5),u("ngClass","control"),o(5),u("ngClass","actions"),o(),u("ngClass","contained medium")("disabled",e.isSubmitting()),o(),M(" ",e.isLogin()?"Login":"Create Account"," "),o(),u("ngClass","basic large"),o(),M(" ",e.isLogin()?"Create new account":"Login with existing account"," "),o(),E(e.error().error_state?22:-1))},dependencies:[U,Q,H,Y,z,J,B,W],styles:[".auth[_ngcontent-%COMP%]{margin:3rem auto;width:95%;max-width:25rem;border-radius:6px;padding:1rem;text-align:center}.auth[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center}.control[_ngcontent-%COMP%]{margin-bottom:.5rem}.control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:700;margin-bottom:.5rem}.actions[_ngcontent-%COMP%]{margin-top:1.5rem;display:flex;flex-direction:column;align-items:center;gap:20px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}.header[_ngcontent-%COMP%]{margin:0;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;font-size:1.5rem;line-height:1.334;letter-spacing:0em;display:block;padding:16px}"]})}}return r})();var me=[{path:"",component:ee}],te=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=b({type:r})}static{this.\u0275inj=w({imports:[R.forChild(me),R]})}}return r})();var Ve=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=b({type:r})}static{this.\u0275inj=w({imports:[k,K,X,te]})}}return r})();export{Ve as LoginModule};
