import{a as we}from"./chunk-PHCYBNDJ.js";import{a as be,b as Ae,c as Pe,d as _e}from"./chunk-5BL4AN2G.js";import{a as ue}from"./chunk-MDPPAVRL.js";import{a as me,b as he,c as fe}from"./chunk-E3JQL47Z.js";import{b as de}from"./chunk-EPS5JTFB.js";import{a as P,b as R,d as j}from"./chunk-TB2NPGND.js";import{a as pe}from"./chunk-NQ5HE5ZT.js";import{D as re,c as ie,g as oe,i as ne,k as O,oa as se,qa as ae,r as E,ra as f,sa as w,ta as L,ua as le,va as ce,wa as A}from"./chunk-KMYELJ2F.js";import{Ba as Q,Db as c,Eb as u,Hb as _,Ib as a,Jb as s,Jc as I,Kb as T,Oc as M,Pb as N,Rb as x,Tb as m,U as b,Xb as K,Yb as X,Zb as Y,_ as q,_a as d,a as F,b as B,ca as H,cc as h,da as g,ea as z,f as U,fc as Z,g as l,gc as ee,hc as te,ja as J,k as G,ka as v,la as S,nb as V,wa as r}from"./chunk-XGJ3VW6B.js";var Re=()=>{let t=()=>{i.update(o=>B(F({},o),{width:window.innerWidth,height:window.innerHeight,viewnote_width:document.querySelector("#viewnote_id")&&document.querySelector("#viewnote_id").clientWidth<window.innerWidth?document.querySelector("#viewnote_id").clientWidth:document.querySelector("#viewnote_id")?window.innerWidth-f.VIEWNOTE_PADDING_MOBILE:window.innerWidth-f.VIEWNOTE_PADDING}))},i=r({width:0,height:0,viewnote_width:0,addListener:()=>{window.addEventListener("resize",t)},removeListener:()=>{window.removeEventListener("resize",t)}});return t(),i},Ce=Re;var je=f,ge=(t,n,e)=>l(null,null,function*(){let i;try{if(i=yield fetch(L.APP_API_ENDPOINT+`api/data/notebook/${n}/${e}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),i.status===404)throw new Error(`${i.url} Not Found.`)}catch(p){return{error:w(p)}}let o;try{if(o=yield i.json(),o===null)return{error:`${je.NOTE_ERROR}`}}catch(p){return{error:w(p)}}return o.error?{error:o.error}:o});var He=f,ve=(t,n,e,i)=>l(null,null,function*(){let o,p={notebookID:n,noteID:e,note:i};try{if(o=yield fetch(L.APP_API_ENDPOINT+"api/data/save-note",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(p)}),o.status===404)throw new Error(`${o.url} Not Found.`)}catch($){return{error:w($)}}let C;try{if(C=yield o.json(),C===null)return{error:`${He.NOTE_SAVE_ERROR}`}}catch($){return{error:w($)}}return C.error?{error:C.error}:C});var We=f,Se=(t,n)=>l(null,null,function*(){let e;try{if(e=yield fetch(L.APP_API_ENDPOINT+"api/data/create-note",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(n)}),e.status===404)throw new Error(`${e.url} Not Found.`)}catch(o){return{error:w(o)}}let i;try{if(i=yield e.json(),i===null)return{error:`${We.NOTE_CREATE_ERROR}`}}catch(o){return{error:w(o)}}return i.error?{error:i.error}:i});var D=!1,k,y,Te=()=>{k=document.querySelector("#edit"),y=document.querySelector("#view"),Fe()};var Ne=(t,n)=>{let e=n.scrollHeight-n.clientHeight,i=t.scrollTop/(t.scrollHeight-t.clientHeight)*100;return e*(i/100)},xe=()=>{k?.removeEventListener("scroll",Ee),y?.removeEventListener("scroll",ke)},Ee=()=>{let t=y,e=Ne(k,t);var i=D;D=!1,!i&&(D=!0,t.scrollTop=e)},ke=()=>{let t=y,n=k,e=Ne(t,n);var i=D;D=!1,!i&&(D=!0,n.scrollTop=e)},Fe=()=>{y!==null&&k!==null&&k.addEventListener("scroll",Ee),y!==null&&k!==null&&y.addEventListener("scroll",ke)};var ye=(()=>{class t{constructor(e,i){this.auth=e,this.router=i,this.jwtHelper=new ce,this.deactivate=!0}canActivate(){return l(this,null,function*(){let e=yield this.auth.authGuardVerify();return e||(this.router.navigate(["login"]),!1)})}canDeactivate(){return this.deactivate}static{this.\u0275fac=function(i){return new(i||t)(H(A),H(O))}}static{this.\u0275prov=q({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Ie=U(Ae()),Me=U(Pe());function Ue(t,n){t&1&&T(0,"ngx-skeleton-loader",3)}function Ge(t,n){if(t&1&&T(0,"ViewNoteMarkdown",4),t&2){let e=m();_("splitScreen",e.splitScreen)("viewText",e.contextView())("updatedViewText",e.updateViewText)("disableLinks",!1)}}window.global=window;global.Buffer=global.Buffer||Me.Buffer;window.process={version:""};var Le=(()=>{class t{set viewText(e){this.content=(0,Ie.default)(e).content,this.content!==this.contextView()&&(this.contextView.update(i=>this.content),this.hideSkeleton())}constructor(){this.contextView=r(""),this.isLoaded=r(!1),this.hideSkeleton=()=>{this.loadedTimer=setTimeout(()=>{this.isLoaded.set(!0),clearTimeout(this.loadedTimer)},300)},this.updateViewText=e=>{this.updatedViewText(e)}}ngOnInit(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=V({type:t,selectors:[["ViewNote"]],inputs:{visible:"visible",splitScreen:"splitScreen",viewText:"viewText",updatedViewText:"updatedViewText"},decls:6,vars:5,consts:[["id","view",3,"ngClass"],["ngClass","cardcontent"],["id","viewnote_id","ngClass","viewnote_content viewer viewnote_content"],["count","1","appearance","line"],[3,"splitScreen","viewText","updatedViewText","disableLinks"]],template:function(i,o){i&1&&(a(0,"div",0)(1,"mat-card")(2,"mat-card-content",1)(3,"article",2),c(4,Ue,1,0,"ngx-skeleton-loader",3),c(5,Ge,1,4,"ViewNoteMarkdown",4),s()()()()),i&2&&(_("ngClass",te("view ",o.splitScreen?"view_split show":""," editnote_box ",o.visible?"show":"hide"," ")),d(4),u(o.isLoaded()?-1:4),d(),u(o.isLoaded()?5:-1))},dependencies:[M,I,j,P,R,fe,he,_e],encapsulation:2})}}return t})();var qe=["noteInputRef"],De=(()=>{class t{constructor(){this.isVisible=r(!1),this.isSplitscreen=r(!1),this.setText=e=>{this.updateViewText(e.currentTarget.innerText)}}set passUpdatedViewText(e){this.noteInputRef&&this.noteInputRef.nativeElement&&this.noteInputRef.nativeElement.innerText!==e&&(this.noteInputRef.nativeElement.innerText=e)}ngOnChanges(e){e.visible&&this.isVisible.set(e.visible.currentValue),e.splitScreen&&this.isSplitscreen.set(e.splitScreen.currentValue)}ngOnInit(){}ngAfterViewInit(){this.loadedText===""&&this.noteInputRef.nativeElement&&this.noteInputRef.nativeElement.focus(),this.loadedText&&this.noteInputRef.nativeElement&&(this.noteInputRef.nativeElement.innerText=this.loadedText)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=V({type:t,selectors:[["EditNote"]],viewQuery:function(i,o){if(i&1&&K(qe,5),i&2){let p;X(p=Y())&&(o.noteInputRef=p.first)}},inputs:{visible:"visible",splitScreen:"splitScreen",loadedText:"loadedText",updateViewText:"updateViewText",passUpdatedViewText:"passUpdatedViewText"},features:[Q],decls:6,vars:4,consts:[["noteInputRef",""],["id","edit",3,"ngClass"],["ngClass","viewnote_content editor"],["ngClass","viewnote_content editable","data-placeholder","Start writing...'",3,"input","contentEditable"]],template:function(i,o){if(i&1){let p=N();a(0,"div",1)(1,"mat-card")(2,"mat-card-content")(3,"article",2)(4,"div",3,0),x("input",function($){return v(p),S(o.setText($))}),s()()()()()}i&2&&(_("ngClass",ee("edit editnote_box ",o.isVisible()?"show editting":o.isSplitscreen()?"show":"hide")),d(4),_("contentEditable",Z(o.isVisible()||o.isSplitscreen())))},dependencies:[M,I,j,P,R],encapsulation:2})}}return t})();function ze(t,n){t&1&&T(0,"LoadingScreen")}function Je(t,n){if(t&1&&(a(0,"div",1),T(1,"ViewNote",7)(2,"EditNote",8),s()),t&2){let e=m();d(),_("visible",!e.isView())("splitScreen",e.isSplitScreen())("viewText",e.viewText())("updatedViewText",e.updatedViewTextHandler),d(),_("visible",e.isView())("splitScreen",e.isSplitScreen())("loadedText",e.loadedText())("updateViewText",e.updatedViewTextHandler)("passUpdatedViewText",e.updateEditTextProp())}}function Qe(t,n){if(t&1){let e=N();a(0,"button",9),x("click",function(){v(e);let o=m();return S(o.saveNoteCallback())}),a(1,"span",10)(2,"span",11),h(3," add_circle "),s(),h(4," Save Note "),s()()}}function Ke(t,n){if(t&1){let e=N();a(0,"button",12),x("click",function(){v(e);let o=m();return S(o.createNotePost())}),a(1,"span",10)(2,"span",11),h(3," add_circle "),s(),h(4," Create Note "),s()()}}function Xe(t,n){if(t&1){let e=N();a(0,"button",13),x("click",function(){v(e);let o=m();return S(o.exampleNote())}),a(1,"span",10)(2,"span",11),h(3," egg "),s(),h(4," Example "),s()()}}function Ye(t,n){t&1&&(a(0,"span",10)(1,"span",11),h(2," visibility "),s(),h(3," View "),s())}function Ze(t,n){t&1&&(a(0,"span",10)(1,"span",11),h(2," edit "),s(),h(3," Edit "),s())}function et(t,n){if(t&1){let e=N();a(0,"button",14),x("click",function(){v(e);let o=m();return S(o.toggleEditHandlerCallback())}),c(1,Ye,4,0,"span",10),c(2,Ze,4,0,"span",10),s()}if(t&2){let e=m();d(),u(e.isView()?1:-1),d(),u(e.isView()?-1:2)}}function tt(t,n){t&1&&(a(0,"span",16),T(1,"img",17),s())}function it(t,n){t&1&&(a(0,"span",16),T(1,"img",18),s())}function ot(t,n){if(t&1){let e=N();a(0,"button",15),x("click",function(){v(e);let o=m();return S(o.toggleSplitHandlerCallback())}),c(1,tt,2,0,"span",16),c(2,it,2,0,"span",16),s()}if(t&2){let e=m();d(),u(e.isSplitScreen()?1:-1),d(),u(e.isSplitScreen()?-1:2)}}var nt=f,$e=(()=>{class t{constructor(){this.activatedRoute=g(ne),this.authService=g(A),this.store=g(re),this.http=g(ie),this.router=g(O),this.authGuard=g(ye),this.new_note=!1,this.WELCOME_NOTE=r(""),this.viewText=r(""),this.loadedText=r(""),this.isMobile=r(!1),this.originalText=r(""),this.updateEditTextProp=r(""),this.noteLoaded=r(!1),this.notebookLoaded=r(!1),this.autoSave=r(!1),this.autoSave$=E(this.autoSave),this.isChanged=r(!1),this.isChanged$=E(this.isChanged),this.isCreate=r(this.new_note),this.isCreate$=E(this.isCreate),this.isView=r(this.new_note),this.isView$=E(this.isView),this.isSplitScreen=r(!1),this.isSplitScreen$=E(this.isSplitScreen),this.unsavedChanges=r(!0),this.injector=g(z),this.onDestroy$=new G,this.showSnack=()=>{this.store.dispatch(we.showSnack({snack:{n_status:!0,message:"Note Saved"}}))},this.exampleNote=()=>{this.isMobile()||this.isSplitScreen.set(!0),this.updatedViewTextHandler(this.WELCOME_NOTE())},this.updatedViewTextHandler=e=>{this.updateIsChanged(e),this.viewText.update(i=>e),this.updateEditTextProp.set(e)},this.updateIsChanged=e=>{e!==this.originalText()?this.isChanged.update(i=>!0):this.isChanged.update(i=>!1)},this.createNotePost=()=>l(this,null,function*(){if(this.token&&this.notebookId&&this.viewText()){this.autoSave.set(!1);let e={notebookId:this.notebookId,note:this.viewText()};try{let i=yield Se(this.token,e);if(this.notebookLoaded.set(!0),i.error){this.showNotification(`${i.error}`);return}i.success&&(this.isCreate.set(!1),this.isChanged.set(!1),this.autoSave.set(!1),this.router.navigate([`/notebook/${this.notebookId}`]))}catch(i){this.showNotification(`${i}`);return}}}),this.saveNoteCheck=()=>l(this,null,function*(){this.autoSave()&&this.isChanged()&&(this.isView()||this.isChanged())&&!this.isCreate()&&l(this,null,function*(){yield this.saveNoteCallback(),this.autoSave.update(i=>!1),this.isChanged.set(!1),this.authGuard.deactivate=!0,this.router.navigate([`${this.navigationUrl}`])})}),this.toggleEditHandlerCallback=()=>{this.isView.set(!this.isView())},this.toggleSplitHandlerCallback=()=>{this.isSplitScreen.set(!this.isSplitScreen())},this.saveNoteCallback=()=>l(this,null,function*(){if(this.token&&this.notebookId&&this.noteId&&this.viewText()){let e;try{if(e=yield ve(this.token,this.notebookId,this.noteId,this.viewText()),e.error){this.showNotification(`${e.error}`);return}if(e.success)return this.isChanged.update(i=>!1),this.autoSave.update(i=>!1),this.originalText.set(this.viewText()),this.isView()&&this.toggleEditHandlerCallback(),e}catch(i){this.showNotification(`${i}`);return}}else return}),this.dimensionsChange=()=>{this.addListener(),this.width<nt.SPLITSCREEN_MINIMUM_WIDTH?(this.isSplitScreen.set(!1),this.isMobile.set(!0)):this.isMobile.set(!1)},this.loadMarkdown=()=>l(this,null,function*(){this.http.get("../../assets/markdown/welcome_markdown_angular.md",{responseType:"text"}).subscribe(e=>{this.WELCOME_NOTE.set(e)})}),this.loadNote=()=>l(this,null,function*(){if(!this.isCreate()&&this.notebookId&&this.noteId&&this.noteId!=="create-note"&&!this.noteLoaded()&&this.token){this.noteLoaded.set(!1);try{let e=yield ge(this.token,this.notebookId,this.noteId);if(e.error){this.showNotification(`${e.error}`);return}e.success&&(this.viewText.set(e.note.note),this.loadedText.set(e.note.note),this.originalText.set(e.note.note),this.noteLoaded.set(!0))}catch(e){this.showNotification(`${e}`);return}}else this.noteLoaded.set(!0)}),this.loadNotebook=()=>l(this,null,function*(){if(!this.notebookLoaded()&&this.token&&this.notebookId){this.notebookLoaded.set(!1);try{let e=yield be(this.token,this.notebookId);if(this.notebookLoaded.set(!0),e.error){this.showNotification(`${e.error}`);return}e.success&&this.store.dispatch(ue.edited(e.notebook))}catch(e){this.showNotification(`${e}`),this.notebookLoaded.set(!0);return}}}),this.updateContext=e=>{this.loading=e.loading,this.token=e.token},this.showNotification=e=>{this.store.dispatch(le.showNotification({notification:{n_status:"error",title:"Error!",message:e}}))}}ngOnDestroy(){this.removeListener(),xe(),this.onDestroy$.next(),this.onDestroy$.complete()}ngOnInit(){this.router.events.pipe(b(this.onDestroy$)).subscribe(e=>{e instanceof oe&&(this.navigationUrl=e.url,this.isChanged()&&!this.isCreate()&&(this.authGuard.deactivate=!1,this.autoSave.update(i=>!0)))}),J(this.injector,()=>{this.windowDimensions$=E(Ce()),this.windowDimensions$.pipe(b(this.onDestroy$)).subscribe(e=>{this.width=e.width,this.height=e.height,this.addListener=e.addListener,this.removeListener=e.removeListener,this.dimensionsChange()}),this.autoSave$.pipe(b(this.onDestroy$)).subscribe(e=>{e&&(this.saveNoteCheck(),this.showSnack())})}),this.activatedRoute.params.pipe(b(this.onDestroy$)).subscribe(e=>{this.noteId=e.noteId,this.notebookId=e.notebookId}),this.authService.authContext$.pipe(b(this.onDestroy$)).subscribe(e=>{this.updateContext(e)}),this.loadNote(),this.loadNotebook(),this.loadMarkdown(),setTimeout(()=>{Te()},500),this.noteId==="create-note"&&(this.new_note=!0,this.isCreate.set(!0),this.isView.set(!0)),this.isChanged$.pipe(b(this.onDestroy$)).subscribe(e=>{e&&this.saveNoteCheck()}),this.isView$.pipe(b(this.onDestroy$)).subscribe(e=>{e&&this.saveNoteCheck()}),this.isCreate$.pipe(b(this.onDestroy$)).subscribe(e=>{e&&this.saveNoteCheck()})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=V({type:t,selectors:[["Note"]],decls:9,vars:7,consts:[["ngClass","page_scrollable_header_breadcrumb_footer"],["ngClass","view_container","id","view_container"],["mat-button","","color","secondary","aria-label","Save Note button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Create Note button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Example Note button","ngClass","contained medium breadcrumb_edit_fab button_fab example_button"],["mat-button","","color","secondary","aria-label","Toggle View button","ngClass","contained medium breadcrumb_edit_fab button_fab"],["mat-button","","color","secondary","aria-label","Toggle Split Screen button","ngClass","contained medium breadcrumb_edit_fab button_fab split_screen_button"],[3,"visible","splitScreen","viewText","updatedViewText"],[3,"visible","splitScreen","loadedText","updateViewText","passUpdatedViewText"],["mat-button","","color","secondary","aria-label","Save Note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["ngClass","icon_text"],["ngClass","material-symbols-outlined button_icon white"],["mat-button","","color","secondary","aria-label","Create Note button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Example Note button","ngClass","contained medium breadcrumb_edit_fab button_fab example_button",3,"click"],["mat-button","","color","secondary","aria-label","Toggle View button","ngClass","contained medium breadcrumb_edit_fab button_fab",3,"click"],["mat-button","","color","secondary","aria-label","Toggle Split Screen button","ngClass","contained medium breadcrumb_edit_fab button_fab split_screen_button",3,"click"],["className","split_screen_icon"],["src","/assets/images/split_screen_icon_single.png","alt","split screen icon","width","30","height","30"],["src","/assets/images/split_screen_icon_double.png","alt","split screen icon","width","30","height","30"]],template:function(i,o){i&1&&(c(0,ze,1,0,"LoadingScreen"),a(1,"div",0),c(2,Je,3,9,"div",1),s(),a(3,"Footer"),c(4,Qe,5,0,"button",2),c(5,Ke,5,0,"button",3),c(6,Xe,5,0,"button",4),c(7,et,3,2,"button",5),c(8,ot,3,2,"button",6),s()),i&2&&(u(!o.noteLoaded()||o.token===null?0:-1),d(2),u(o.noteLoaded()&&o.token!==null?2:-1),d(2),u(o.noteLoaded()&&o.viewText().length>0&&!o.isCreate()&&o.isChanged()?4:-1),d(),u(o.noteLoaded()&&o.viewText().length>0&&o.isCreate()?5:-1),d(),u(o.noteLoaded()&&o.viewText().length===0&&o.isCreate()?6:-1),d(),u(o.noteLoaded()&&!o.isSplitScreen()?7:-1),d(),u(o.noteLoaded()&&!o.isMobile()?8:-1))},dependencies:[M,I,ae,se,de,pe,me,Le,De],encapsulation:2,changeDetection:0})}}return t})();var Ti=[{path:"",component:$e}];export{Ti as noteRoutes};
